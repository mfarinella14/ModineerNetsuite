{
	"$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
	"contentVersion": "1.0.0.0",
	"parameters": {
		"workspaceName": {
			"type": "string",
			"metadata": "Workspace name",
			"defaultValue": "modineerworkspace"
		},
		"GlobalShopData_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'GlobalShopData'"
		},
		"GlobalShopData_password": {
			"type": "secureString",
			"metadata": "Secure string for 'password' of 'GlobalShopData'"
		},
		"GloviaData_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'GloviaData'"
		},
		"HTM_NetSuite_password": {
			"type": "secureString",
			"metadata": "Secure string for 'password' of 'HTM_NetSuite'"
		},
		"Infor_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'Infor'"
		},
		"Legacy HTM Netsuite Refresh Token_password": {
			"type": "secureString",
			"metadata": "Secure string for 'password' of 'Legacy HTM Netsuite Refresh Token'"
		},
		"ModineerSQLPool_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'ModineerSQLPool'"
		},
		"ModineerTableStorage_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'ModineerTableStorage'"
		},
		"NetsuiteODBC_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'NetsuiteODBC'"
		},
		"NetsuiteODBC_password": {
			"type": "secureString",
			"metadata": "Secure string for 'password' of 'NetsuiteODBC'"
		},
		"PlexODBC_LS_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'PlexODBC_LS'"
		},
		"modineerworkspace-WorkspaceDefaultSqlServer_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'modineerworkspace-WorkspaceDefaultSqlServer'"
		},
		"GlobalShopData_properties_typeProperties_userName": {
			"type": "string",
			"defaultValue": "Administrator"
		},
		"HTM_NetSuite_properties_typeProperties_url": {
			"type": "string",
			"defaultValue": "https://3675944.restlets.api.netsuite.com"
		},
		"HTM_NetSuite_properties_typeProperties_userName": {
			"type": "string",
			"defaultValue": "228ec78c8e0232dce7bb92d461600c6f78ae03778e6e1aa272d5162312799e4a"
		},
		"Legacy HTM Netsuite Refresh Token_properties_typeProperties_url": {
			"type": "string",
			"defaultValue": "@{concat('https://',linkedService().account_id,'.suitetalk.api.netsuite.com/services/rest/auth/oauth2/v1/token')}"
		},
		"Legacy HTM Netsuite Refresh Token_properties_typeProperties_userName": {
			"type": "string",
			"defaultValue": "d0d192e2ea6cd632f5b5775a77df8351e1f9af463f9be2bb5c4310a94b6ca6d2"
		},
		"Netsuite SuiteQL_properties_typeProperties_url": {
			"type": "string",
			"defaultValue": "https://3675944.suitetalk.api.netsuite.com/services/rest/query/v1/suiteql"
		},
		"NetsuiteODBC_properties_typeProperties_userName": {
			"type": "string",
			"defaultValue": "mfarinella@modineer.com"
		},
		"NetsuiteUnAuthorized_properties_typeProperties_url": {
			"type": "string",
			"defaultValue": "https://4828307.app.netsuite.com/core/media/"
		},
		"modineerlake_properties_typeProperties_url": {
			"type": "string",
			"defaultValue": "https://modineerlake.dfs.core.windows.net/"
		},
		"modineerworkspace-WorkspaceDefaultStorage_properties_typeProperties_url": {
			"type": "string",
			"defaultValue": "https://modineerlake.dfs.core.windows.net"
		}
	},
	"variables": {
		"workspaceId": "[concat('Microsoft.Synapse/workspaces/', parameters('workspaceName'))]"
	},
	"resources": [
		{
			"name": "[concat(parameters('workspaceName'), '/Data Merge')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Merge SP After Table Created",
						"type": "SqlPoolStoredProcedure",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"sqlPool": {
							"referenceName": "Modineer",
							"type": "SqlPoolReference"
						},
						"typeProperties": {
							"storedProcedureName": "[Config].[usp_MergeData]",
							"storedProcedureParameters": {
								"KeyColumns": {
									"value": {
										"value": "@{pipeline().parameters.item.TableKeysArray}",
										"type": "Expression"
									},
									"type": "String"
								},
								"SchemaName": {
									"value": {
										"value": "@{pipeline().parameters.item.SchemaName}",
										"type": "Expression"
									},
									"type": "String"
								},
								"StagingSchema": {
									"value": {
										"value": "@{pipeline().parameters.item.StagingSchema}",
										"type": "Expression"
									},
									"type": "String"
								},
								"TableName": {
									"value": {
										"value": "@{pipeline().parameters.item.TableName}",
										"type": "Expression"
									},
									"type": "String"
								}
							}
						}
					},
					{
						"name": "Insert Delta Data To Production",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "Merge SP After Table Created",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlDWSource",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "SqlDWSink",
								"preCopyScript": {
									"value": "DELETE FROM @{pipeline().parameters.item.SchemaName}.@{pipeline().parameters.item.TableName} WHERE CONCAT(@{pipeline().parameters.item.TableKeysArray}) IN (SELECT CONCAT(@{pipeline().parameters.item.TableKeysArray}) FROM @{pipeline().parameters.item.StagingSchema}.@{pipeline().parameters.item.TableName})",
									"type": "Expression"
								},
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "AzureSynapseDatabase",
								"type": "DatasetReference",
								"parameters": {
									"TableName": {
										"value": "@pipeline().parameters.item.TableName",
										"type": "Expression"
									},
									"DbName": {
										"value": "@pipeline().parameters.item.DbName",
										"type": "Expression"
									},
									"SchemaName": {
										"value": "@pipeline().parameters.item.StagingSchema",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "AzureSynapseDatabase",
								"type": "DatasetReference",
								"parameters": {
									"TableName": {
										"value": "@pipeline().parameters.item.TableName",
										"type": "Expression"
									},
									"DbName": {
										"value": "@pipeline().parameters.item.DbName",
										"type": "Expression"
									},
									"SchemaName": {
										"value": "@pipeline().parameters.item.SchemaName",
										"type": "Expression"
									}
								}
							}
						]
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"item": {
						"type": "object"
					},
					"DateData": {
						"type": "object"
					}
				},
				"folder": {
					"name": "Master Data/Slave Pipelines"
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/sqlPools/Modineer')]",
				"[concat(variables('workspaceId'), '/datasets/AzureSynapseDatabase')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Data Refresh Delta')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Get Refresh Tables",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "Get EST Date",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlPoolSource",
								"sqlReaderStoredProcedureName": "[Config].[DataRefresh]",
								"queryTimeout": "02:00:00"
							},
							"dataset": {
								"referenceName": "Modineer",
								"type": "DatasetReference",
								"parameters": {}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach Table",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Get Refresh Tables",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Get Refresh Tables').output.value",
								"type": "Expression"
							},
							"isSequential": false,
							"batchCount": 10,
							"activities": [
								{
									"name": "Switch on RowGroup",
									"type": "Switch",
									"dependsOn": [
										{
											"activity": "Set Table as Updating",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"on": {
											"value": "@item().RowGroup",
											"type": "Expression"
										},
										"cases": [
											{
												"value": "GloviaProd",
												"activities": [
													{
														"name": "Glovia Delta Refresh",
														"type": "ExecutePipeline",
														"dependsOn": [],
														"userProperties": [],
														"typeProperties": {
															"pipeline": {
																"referenceName": "Glovia Delta Refresh",
																"type": "PipelineReference"
															},
															"waitOnCompletion": true,
															"parameters": {
																"Item": {
																	"value": "@item()",
																	"type": "Expression"
																},
																"EstDate": {
																	"value": "@activity('Get EST Date').output",
																	"type": "Expression"
																}
															}
														}
													}
												]
											},
											{
												"value": "Netsuite",
												"activities": [
													{
														"name": "Execute Netsuite Data Refresh",
														"type": "ExecutePipeline",
														"dependsOn": [],
														"userProperties": [],
														"typeProperties": {
															"pipeline": {
																"referenceName": "Netsuite Data Refresh",
																"type": "PipelineReference"
															},
															"waitOnCompletion": true,
															"parameters": {
																"item": {
																	"value": "@item()",
																	"type": "Expression"
																},
																"EstDate": {
																	"value": "@activity('Get EST Date').output.firstRow",
																	"type": "Expression"
																}
															}
														}
													}
												]
											},
											{
												"value": "Plex",
												"activities": [
													{
														"name": "Plex Data Refresh",
														"type": "ExecutePipeline",
														"dependsOn": [],
														"userProperties": [],
														"typeProperties": {
															"pipeline": {
																"referenceName": "Plex Data Refresh - Data Count",
																"type": "PipelineReference"
															},
															"waitOnCompletion": true,
															"parameters": {
																"item": {
																	"value": "@item()",
																	"type": "Expression"
																},
																"EstDate": {
																	"value": "@activity('Get EST Date').output",
																	"type": "Expression"
																}
															}
														}
													}
												]
											},
											{
												"value": "Infor",
												"activities": [
													{
														"name": "Infor Data Refresh",
														"type": "ExecutePipeline",
														"dependsOn": [],
														"userProperties": [],
														"typeProperties": {
															"pipeline": {
																"referenceName": "Infor Data Refresh",
																"type": "PipelineReference"
															},
															"waitOnCompletion": true,
															"parameters": {
																"Item": {
																	"value": "@item()",
																	"type": "Expression"
																},
																"EstDate": {
																	"value": "@activity('Get EST Date').output.FirstRow",
																	"type": "Expression"
																}
															}
														}
													}
												]
											}
										],
										"defaultActivities": [
											{
												"name": "Place Holder",
												"type": "Wait",
												"dependsOn": [],
												"userProperties": [],
												"typeProperties": {
													"waitTimeInSeconds": 1
												}
											}
										]
									}
								},
								{
									"name": "Set Table as Updating",
									"type": "SqlPoolStoredProcedure",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"sqlPool": {
										"referenceName": "Modineer",
										"type": "SqlPoolReference"
									},
									"typeProperties": {
										"storedProcedureName": "[Config].[SetAsUpdating]",
										"storedProcedureParameters": {
											"nextRefresh": {
												"value": {
													"value": "@addToTime(utcnow(),item().RefreshNumber,item().RefreshInterval)",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"rowId": {
												"value": {
													"value": "@item().Id",
													"type": "Expression"
												},
												"type": "Int32"
											}
										}
									}
								},
								{
									"name": "Set Table to Processed",
									"type": "SqlPoolStoredProcedure",
									"dependsOn": [
										{
											"activity": "Switch on RowGroup",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"sqlPool": {
										"referenceName": "Modineer",
										"type": "SqlPoolReference"
									},
									"typeProperties": {
										"storedProcedureName": "[Config].[SetAsUpdated]",
										"storedProcedureParameters": {
											"rowId": {
												"value": {
													"value": "@item().Id",
													"type": "Expression"
												},
												"type": "Int32"
											}
										}
									}
								},
								{
									"name": "Failed To Update",
									"type": "SqlPoolStoredProcedure",
									"dependsOn": [
										{
											"activity": "Switch on RowGroup",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"sqlPool": {
										"referenceName": "Modineer",
										"type": "SqlPoolReference"
									},
									"typeProperties": {
										"storedProcedureName": "[Config].[FailedToUpdate]",
										"storedProcedureParameters": {
											"RowId": {
												"value": {
													"value": "@item().Id",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowSCN": {
												"value": {
													"value": "@item().TableMaxSCN",
													"type": "Expression"
												},
												"type": "Int64"
											}
										}
									}
								}
							]
						}
					},
					{
						"name": "Get EST Date",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlPoolSource",
								"sqlReaderStoredProcedureName": "[Config].[usp_GetESTDate]",
								"queryTimeout": "02:00:00"
							},
							"dataset": {
								"referenceName": "Modineer",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"folder": {
					"name": "Master Data"
				},
				"annotations": [],
				"lastPublishTime": "2021-11-12T20:33:37Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/Modineer')]",
				"[concat(variables('workspaceId'), '/sqlPools/Modineer')]",
				"[concat(variables('workspaceId'), '/pipelines/Glovia Delta Refresh')]",
				"[concat(variables('workspaceId'), '/pipelines/Netsuite Data Refresh')]",
				"[concat(variables('workspaceId'), '/pipelines/Plex Data Refresh - Data Count')]",
				"[concat(variables('workspaceId'), '/pipelines/Infor Data Refresh')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Data Refresh')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Get Refresh Tables",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlPoolSource",
								"sqlReaderStoredProcedureName": "[Config].[DataRefresh]",
								"queryTimeout": "02:00:00"
							},
							"dataset": {
								"referenceName": "Modineer",
								"type": "DatasetReference",
								"parameters": {}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach Table",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Get Refresh Tables",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Get Refresh Tables').output.value",
								"type": "Expression"
							},
							"isSequential": false,
							"batchCount": 10,
							"activities": [
								{
									"name": "Switch on RowGroup",
									"type": "Switch",
									"dependsOn": [
										{
											"activity": "Set Table as Updating_copy1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"on": {
											"value": "@item().RowGroup",
											"type": "Expression"
										},
										"cases": [
											{
												"value": "GloviaProd",
												"activities": [
													{
														"name": "Get SCN Number",
														"type": "Lookup",
														"dependsOn": [],
														"policy": {
															"timeout": "7.00:00:00",
															"retry": 0,
															"retryIntervalInSeconds": 30,
															"secureOutput": false,
															"secureInput": false
														},
														"userProperties": [],
														"typeProperties": {
															"source": {
																"type": "OracleSource",
																"oracleReaderQuery": {
																	"value": "@concat('SELECT MAX(ORA_ROWSCN) AS \"SCNValue\" FROM ',item().SchemaName,'.',item().TableName)",
																	"type": "Expression"
																},
																"partitionOption": "None",
																"queryTimeout": "02:00:00"
															},
															"dataset": {
																"referenceName": "GloviaProd",
																"type": "DatasetReference",
																"parameters": {
																	"tablename": {
																		"value": "@item().TableName",
																		"type": "Expression"
																	},
																	"schemaname": {
																		"value": "@item().SchemaName",
																		"type": "Expression"
																	}
																}
															}
														}
													},
													{
														"name": "Update SCN",
														"type": "SqlPoolStoredProcedure",
														"dependsOn": [
															{
																"activity": "Get SCN Number",
																"dependencyConditions": [
																	"Succeeded"
																]
															}
														],
														"policy": {
															"timeout": "7.00:00:00",
															"retry": 0,
															"retryIntervalInSeconds": 30,
															"secureOutput": false,
															"secureInput": false
														},
														"userProperties": [],
														"sqlPool": {
															"referenceName": "Modineer",
															"type": "SqlPoolReference"
														},
														"typeProperties": {
															"storedProcedureName": "[Config].[UpdateSCN]",
															"storedProcedureParameters": {
																"Id": {
																	"value": {
																		"value": "@item().Id",
																		"type": "Expression"
																	},
																	"type": "Int32"
																},
																"SCN": {
																	"value": {
																		"value": "@activity('Get SCN Number').output.firstRow.SCNValue",
																		"type": "Expression"
																	},
																	"type": "Int64"
																}
															}
														}
													},
													{
														"name": "Raw Data Copy",
														"type": "Copy",
														"dependsOn": [
															{
																"activity": "Update SCN",
																"dependencyConditions": [
																	"Succeeded"
																]
															}
														],
														"policy": {
															"timeout": "7.00:00:00",
															"retry": 0,
															"retryIntervalInSeconds": 30,
															"secureOutput": true,
															"secureInput": false
														},
														"userProperties": [],
														"typeProperties": {
															"source": {
																"type": "OracleSource",
																"partitionOption": "None",
																"queryTimeout": "02:00:00"
															},
															"sink": {
																"type": "ParquetSink",
																"storeSettings": {
																	"type": "AzureBlobFSWriteSettings"
																},
																"formatSettings": {
																	"type": "ParquetWriteSettings"
																}
															},
															"enableStaging": false
														},
														"inputs": [
															{
																"referenceName": "GloviaProd",
																"type": "DatasetReference",
																"parameters": {
																	"tablename": {
																		"value": "@item().TableName",
																		"type": "Expression"
																	},
																	"schemaname": {
																		"value": "@item().SchemaName",
																		"type": "Expression"
																	}
																}
															}
														],
														"outputs": [
															{
																"referenceName": "SinkParquet",
																"type": "DatasetReference",
																"parameters": {
																	"file_system": {
																		"value": "@item().FileSystem",
																		"type": "Expression"
																	},
																	"directory": {
																		"value": "@concat(item().SchemaName,'/',item().TableName)",
																		"type": "Expression"
																	},
																	"file_name": {
																		"value": "@concat(item().TableName,'.parquet')",
																		"type": "Expression"
																	}
																}
															}
														]
													},
													{
														"name": "Set Table to Processed",
														"type": "SqlPoolStoredProcedure",
														"dependsOn": [
															{
																"activity": "Raw Data Copy",
																"dependencyConditions": [
																	"Succeeded"
																]
															}
														],
														"policy": {
															"timeout": "7.00:00:00",
															"retry": 0,
															"retryIntervalInSeconds": 30,
															"secureOutput": false,
															"secureInput": false
														},
														"userProperties": [],
														"sqlPool": {
															"referenceName": "Modineer",
															"type": "SqlPoolReference"
														},
														"typeProperties": {
															"storedProcedureName": "[Config].[SetAsUpdated]",
															"storedProcedureParameters": {
																"rowId": {
																	"value": {
																		"value": "@item().Id",
																		"type": "Expression"
																	},
																	"type": "Int32"
																}
															}
														}
													},
													{
														"name": "Failed To Update",
														"type": "SqlPoolStoredProcedure",
														"dependsOn": [
															{
																"activity": "Raw Data Copy",
																"dependencyConditions": [
																	"Failed"
																]
															},
															{
																"activity": "Update SCN",
																"dependencyConditions": [
																	"Failed"
																]
															},
															{
																"activity": "Get SCN Number",
																"dependencyConditions": [
																	"Failed"
																]
															}
														],
														"policy": {
															"timeout": "7.00:00:00",
															"retry": 0,
															"retryIntervalInSeconds": 30,
															"secureOutput": false,
															"secureInput": false
														},
														"userProperties": [],
														"sqlPool": {
															"referenceName": "Modineer",
															"type": "SqlPoolReference"
														},
														"typeProperties": {
															"storedProcedureName": "[Config].[FailedToUpdate]",
															"storedProcedureParameters": {
																"RowId": {
																	"value": {
																		"value": "@item().Id",
																		"type": "Expression"
																	},
																	"type": "Int32"
																},
																"RowSCN": {
																	"value": {
																		"value": "@item().TableMaxSCN",
																		"type": "Expression"
																	},
																	"type": "Int32"
																}
															}
														}
													}
												]
											},
											{
												"value": "Netsuite",
												"activities": [
													{
														"name": "Execute Netsuite Data Refresh",
														"type": "ExecutePipeline",
														"dependsOn": [],
														"userProperties": [],
														"typeProperties": {
															"pipeline": {
																"referenceName": "Netsuite Data Refresh",
																"type": "PipelineReference"
															},
															"waitOnCompletion": true,
															"parameters": {
																"item": {
																	"value": "@item()",
																	"type": "Expression"
																}
															}
														}
													},
													{
														"name": "Set as Updated",
														"type": "SqlPoolStoredProcedure",
														"dependsOn": [
															{
																"activity": "Execute Netsuite Data Refresh",
																"dependencyConditions": [
																	"Succeeded"
																]
															}
														],
														"policy": {
															"timeout": "7.00:00:00",
															"retry": 0,
															"retryIntervalInSeconds": 30,
															"secureOutput": false,
															"secureInput": false
														},
														"userProperties": [],
														"sqlPool": {
															"referenceName": "Modineer",
															"type": "SqlPoolReference"
														},
														"typeProperties": {
															"storedProcedureName": "[Config].[SetAsUpdated]",
															"storedProcedureParameters": {
																"rowId": {
																	"value": {
																		"value": "@item().Id",
																		"type": "Expression"
																	},
																	"type": "Int32"
																}
															}
														}
													},
													{
														"name": "Failed",
														"type": "SqlPoolStoredProcedure",
														"dependsOn": [
															{
																"activity": "Execute Netsuite Data Refresh",
																"dependencyConditions": [
																	"Failed"
																]
															}
														],
														"policy": {
															"timeout": "7.00:00:00",
															"retry": 0,
															"retryIntervalInSeconds": 30,
															"secureOutput": false,
															"secureInput": false
														},
														"userProperties": [],
														"sqlPool": {
															"referenceName": "Modineer",
															"type": "SqlPoolReference"
														},
														"typeProperties": {
															"storedProcedureName": "[Config].[FailedToUpdate]",
															"storedProcedureParameters": {
																"RowId": {
																	"value": {
																		"value": "@item().Id",
																		"type": "Expression"
																	},
																	"type": "Int32"
																},
																"RowSCN": {
																	"value": "0",
																	"type": "Int32"
																}
															}
														}
													}
												]
											},
											{
												"value": "Plex",
												"activities": [
													{
														"name": "Wait1",
														"type": "Wait",
														"dependsOn": [],
														"userProperties": [],
														"typeProperties": {
															"waitTimeInSeconds": 1
														}
													}
												]
											}
										],
										"defaultActivities": [
											{
												"name": "Place Holder",
												"type": "Wait",
												"dependsOn": [],
												"userProperties": [],
												"typeProperties": {
													"waitTimeInSeconds": 1
												}
											}
										]
									}
								},
								{
									"name": "Set Table as Updating_copy1",
									"type": "SqlPoolStoredProcedure",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"sqlPool": {
										"referenceName": "Modineer",
										"type": "SqlPoolReference"
									},
									"typeProperties": {
										"storedProcedureName": "[Config].[SetAsUpdating]",
										"storedProcedureParameters": {
											"interval": {
												"value": {
													"value": "@item().RefreshInterval",
													"type": "Expression"
												},
												"type": "String"
											},
											"intervalQty": {
												"value": {
													"value": "@item().RefreshNumber",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"nextRefresh": {
												"value": {
													"value": "@item().NextRefresh",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"rowId": {
												"value": {
													"value": "@item().Id",
													"type": "Expression"
												},
												"type": "Int32"
											}
										}
									}
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"folder": {
					"name": "Master Data"
				},
				"annotations": [],
				"lastPublishTime": "2021-11-12T20:33:37Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/Modineer')]",
				"[concat(variables('workspaceId'), '/sqlPools/Modineer')]",
				"[concat(variables('workspaceId'), '/datasets/GloviaProd')]",
				"[concat(variables('workspaceId'), '/datasets/SinkParquet')]",
				"[concat(variables('workspaceId'), '/pipelines/Netsuite Data Refresh')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Data Refresh_copy1')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Get Refresh Tables",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlPoolSource",
								"sqlReaderStoredProcedureName": "[Config].[DataRefresh]",
								"queryTimeout": "02:00:00"
							},
							"dataset": {
								"referenceName": "Modineer",
								"type": "DatasetReference",
								"parameters": {}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach Table",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Get Refresh Tables",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Get Refresh Tables').output.value",
								"type": "Expression"
							},
							"isSequential": false,
							"batchCount": 4,
							"activities": [
								{
									"name": "Switch on RowGroup",
									"type": "Switch",
									"dependsOn": [],
									"userProperties": [],
									"typeProperties": {
										"on": {
											"value": "@item().RowGroup",
											"type": "Expression"
										},
										"cases": [
											{
												"value": "GloviaProd",
												"activities": [
													{
														"name": "Get SCN Number",
														"type": "Lookup",
														"dependsOn": [],
														"policy": {
															"timeout": "7.00:00:00",
															"retry": 0,
															"retryIntervalInSeconds": 30,
															"secureOutput": false,
															"secureInput": false
														},
														"userProperties": [],
														"typeProperties": {
															"source": {
																"type": "OracleSource",
																"oracleReaderQuery": {
																	"value": "@concat('SELECT MAX(ORA_ROWSCN) AS \"SCNValue\" FROM ',item().SchemaName,'.',item().TableName)",
																	"type": "Expression"
																},
																"partitionOption": "None",
																"queryTimeout": "02:00:00"
															},
															"dataset": {
																"referenceName": "GloviaProd",
																"type": "DatasetReference",
																"parameters": {
																	"tablename": {
																		"value": "@item().TableName",
																		"type": "Expression"
																	},
																	"schemaname": {
																		"value": "@item().SchemaName",
																		"type": "Expression"
																	}
																}
															}
														}
													},
													{
														"name": "Set Table as Updating",
														"type": "SqlPoolStoredProcedure",
														"dependsOn": [
															{
																"activity": "Get SCN Number",
																"dependencyConditions": [
																	"Succeeded"
																]
															}
														],
														"policy": {
															"timeout": "7.00:00:00",
															"retry": 0,
															"retryIntervalInSeconds": 30,
															"secureOutput": false,
															"secureInput": false
														},
														"userProperties": [],
														"sqlPool": {
															"referenceName": "Modineer",
															"type": "SqlPoolReference"
														},
														"typeProperties": {
															"storedProcedureName": "[Config].[SetAsUpdating]",
															"storedProcedureParameters": {
																"interval": {
																	"value": {
																		"value": "@item().RefreshInterval",
																		"type": "Expression"
																	},
																	"type": "String"
																},
																"intervalQty": {
																	"value": {
																		"value": "@item().RefreshNumber",
																		"type": "Expression"
																	},
																	"type": "Int32"
																},
																"rowId": {
																	"value": {
																		"value": "@item().Id",
																		"type": "Expression"
																	},
																	"type": "Int32"
																},
																"SCN": {
																	"value": {
																		"value": "@activity('Get SCN Number').output.firstRow.SCNValue",
																		"type": "Expression"
																	},
																	"type": "Int64"
																}
															}
														}
													},
													{
														"name": "Raw Data Copy",
														"type": "Copy",
														"dependsOn": [
															{
																"activity": "Set Table as Updating",
																"dependencyConditions": [
																	"Succeeded"
																]
															}
														],
														"policy": {
															"timeout": "7.00:00:00",
															"retry": 0,
															"retryIntervalInSeconds": 30,
															"secureOutput": true,
															"secureInput": false
														},
														"userProperties": [],
														"typeProperties": {
															"source": {
																"type": "OracleSource",
																"oracleReaderQuery": {
																	"value": "@concat('SELECT * FROM ',item().SchemaName,'.',item().TableName,' WHERE ORA_ROWSCN >= ',item().TableMaxSCN)",
																	"type": "Expression"
																},
																"partitionOption": "None",
																"queryTimeout": "02:00:00"
															},
															"sink": {
																"type": "ParquetSink",
																"storeSettings": {
																	"type": "AzureBlobFSWriteSettings"
																},
																"formatSettings": {
																	"type": "ParquetWriteSettings"
																}
															},
															"enableStaging": false,
															"parallelCopies": 4
														},
														"inputs": [
															{
																"referenceName": "GloviaProd",
																"type": "DatasetReference",
																"parameters": {
																	"tablename": {
																		"value": "@item().TableName",
																		"type": "Expression"
																	},
																	"schemaname": {
																		"value": "@item().SchemaName",
																		"type": "Expression"
																	}
																}
															}
														],
														"outputs": [
															{
																"referenceName": "SinkParquet",
																"type": "DatasetReference",
																"parameters": {
																	"file_system": {
																		"value": "@item().FileSystem",
																		"type": "Expression"
																	},
																	"directory": {
																		"value": "@concat(item().SchemaName,'/',item().TableName,'/NotProcessed')",
																		"type": "Expression"
																	},
																	"file_name": {
																		"value": "@concat(item().TableName,'-',convertFromUtc(utcnow(), 'Eastern Standard Time'),'.parquet')",
																		"type": "Expression"
																	}
																}
															}
														]
													},
													{
														"name": "Set Table to Processed",
														"type": "SqlPoolStoredProcedure",
														"dependsOn": [
															{
																"activity": "Raw Data Copy",
																"dependencyConditions": [
																	"Failed"
																]
															}
														],
														"policy": {
															"timeout": "7.00:00:00",
															"retry": 0,
															"retryIntervalInSeconds": 30,
															"secureOutput": false,
															"secureInput": false
														},
														"userProperties": [],
														"sqlPool": {
															"referenceName": "Modineer",
															"type": "SqlPoolReference"
														},
														"typeProperties": {
															"storedProcedureName": "[Config].[SetAsUpdated]",
															"storedProcedureParameters": {
																"rowId": {
																	"value": {
																		"value": "@item().Id",
																		"type": "Expression"
																	},
																	"type": "Int32"
																}
															}
														}
													}
												]
											},
											{
												"value": "Netsuite",
												"activities": [
													{
														"name": "Execute Netsuite Data Refresh",
														"type": "ExecutePipeline",
														"dependsOn": [
															{
																"activity": "Set as Updating",
																"dependencyConditions": [
																	"Succeeded"
																]
															}
														],
														"userProperties": [],
														"typeProperties": {
															"pipeline": {
																"referenceName": "Netsuite Data Refresh",
																"type": "PipelineReference"
															},
															"waitOnCompletion": true,
															"parameters": {
																"item": {
																	"value": "@item()",
																	"type": "Expression"
																}
															}
														}
													},
													{
														"name": "Set as Updated",
														"type": "SqlPoolStoredProcedure",
														"dependsOn": [
															{
																"activity": "Execute Netsuite Data Refresh",
																"dependencyConditions": [
																	"Succeeded",
																	"Failed"
																]
															}
														],
														"policy": {
															"timeout": "7.00:00:00",
															"retry": 0,
															"retryIntervalInSeconds": 30,
															"secureOutput": false,
															"secureInput": false
														},
														"userProperties": [],
														"sqlPool": {
															"referenceName": "Modineer",
															"type": "SqlPoolReference"
														},
														"typeProperties": {
															"storedProcedureName": "[Config].[SetAsUpdated]",
															"storedProcedureParameters": {
																"rowId": {
																	"value": {
																		"value": "@item().Id",
																		"type": "Expression"
																	},
																	"type": "Int32"
																}
															}
														}
													},
													{
														"name": "Set as Updating",
														"type": "SqlPoolStoredProcedure",
														"dependsOn": [],
														"policy": {
															"timeout": "7.00:00:00",
															"retry": 0,
															"retryIntervalInSeconds": 30,
															"secureOutput": false,
															"secureInput": false
														},
														"userProperties": [],
														"sqlPool": {
															"referenceName": "Modineer",
															"type": "SqlPoolReference"
														},
														"typeProperties": {
															"storedProcedureName": "[Config].[SetAsUpdating]",
															"storedProcedureParameters": {
																"interval": {
																	"value": {
																		"value": "@item().RefreshInterval",
																		"type": "Expression"
																	},
																	"type": "String"
																},
																"intervalQty": {
																	"value": {
																		"value": "@item().RefreshNumber",
																		"type": "Expression"
																	},
																	"type": "Int32"
																},
																"rowId": {
																	"value": {
																		"value": "@item().Id",
																		"type": "Expression"
																	},
																	"type": "Int32"
																},
																"SCN": {
																	"value": "0",
																	"type": "Int64"
																}
															}
														}
													}
												]
											},
											{
												"value": "Plex",
												"activities": [
													{
														"name": "Place Holder_copy2",
														"type": "Wait",
														"dependsOn": [],
														"userProperties": [],
														"typeProperties": {
															"waitTimeInSeconds": 1
														}
													}
												]
											}
										],
										"defaultActivities": [
											{
												"name": "Place Holder",
												"type": "Wait",
												"dependsOn": [],
												"userProperties": [],
												"typeProperties": {
													"waitTimeInSeconds": 1
												}
											}
										]
									}
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"folder": {
					"name": "Serverless Setup"
				},
				"annotations": [],
				"lastPublishTime": "2021-11-12T20:33:37Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/Modineer')]",
				"[concat(variables('workspaceId'), '/datasets/GloviaProd')]",
				"[concat(variables('workspaceId'), '/sqlPools/Modineer')]",
				"[concat(variables('workspaceId'), '/datasets/SinkParquet')]",
				"[concat(variables('workspaceId'), '/pipelines/Netsuite Data Refresh')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/DataRails')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Copy data1",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "Modineer Netsuite Raw Data Copy - Data Lake",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "OracleSource",
								"partitionOption": "None",
								"queryTimeout": "02:00:00"
							},
							"sink": {
								"type": "SqlDWSink",
								"allowCopyCommand": true,
								"copyCommandSettings": {}
							},
							"enableStaging": true,
							"stagingSettings": {
								"linkedServiceName": {
									"referenceName": "modineerworkspace-WorkspaceDefaultStorage",
									"type": "LinkedServiceReference"
								},
								"path": "unified-data-cluster/GLOVIA_PROD/FIM_BL"
							},
							"parallelCopies": 5
						},
						"inputs": [
							{
								"referenceName": "GloviaProd",
								"type": "DatasetReference",
								"parameters": {
									"tablename": "FIM_BL",
									"schemaname": "GLOVIA_PROD"
								}
							}
						],
						"outputs": [
							{
								"referenceName": "AzureSynapseDatabase",
								"type": "DatasetReference",
								"parameters": {
									"TableName": "FIM_BL",
									"DbName": "Modineer",
									"SchemaName": "GLOVIA_PROD"
								}
							}
						]
					},
					{
						"name": "Modineer Netsuite Raw Data Copy - Data Lake",
						"type": "Copy",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "OdbcSource",
								"query": {
									"value": "SELECT * FROM transaction WHERE lastmodifieddate >= TO_TIMESTAMP(REPLACE(REPLACE('@{addminutes('2021-11-30 14:00:34.457',-15)}','T',' '),'Z',''), 'YYYY-MM-DD HH24:MI:SS.FF')",
									"type": "Expression"
								},
								"queryTimeout": "02:00:00"
							},
							"sink": {
								"type": "ParquetSink",
								"storeSettings": {
									"type": "AzureBlobFSWriteSettings"
								},
								"formatSettings": {
									"type": "ParquetWriteSettings"
								}
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "NetsuiteODBCSource",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "SinkParquet",
								"type": "DatasetReference",
								"parameters": {
									"file_system": {
										"value": "unified-data-cluster",
										"type": "Expression"
									},
									"directory": {
										"value": "ModNS/transaction/2021/12/15",
										"type": "Expression"
									},
									"file_name": {
										"value": "transaction[n].parquet",
										"type": "Expression"
									}
								}
							}
						]
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"folder": {
					"name": "Temp"
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/GloviaProd')]",
				"[concat(variables('workspaceId'), '/datasets/AzureSynapseDatabase')]",
				"[concat(variables('workspaceId'), '/datasets/NetsuiteODBCSource')]",
				"[concat(variables('workspaceId'), '/datasets/SinkParquet')]",
				"[concat(variables('workspaceId'), '/linkedServices/modineerworkspace-WorkspaceDefaultStorage')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Full Data Refresh')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Get All Table Data",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlPoolSource",
								"sqlReaderQuery": {
									"value": "SELECT * FROM Config.DataRefreshSchedule",
									"type": "Expression"
								},
								"queryTimeout": "02:00:00"
							},
							"dataset": {
								"referenceName": "Modineer",
								"type": "DatasetReference",
								"parameters": {}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach1",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Get All Table Data",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Get All Table Data').output.value",
								"type": "Expression"
							},
							"isSequential": false,
							"batchCount": 3,
							"activities": [
								{
									"name": "Determine Source_copy1",
									"type": "Switch",
									"dependsOn": [],
									"userProperties": [],
									"typeProperties": {
										"on": {
											"value": "@item().SchemaName",
											"type": "Expression"
										},
										"cases": [
											{
												"value": "GLOVIA_PROD",
												"activities": [
													{
														"name": "Replicate Tables_copy1",
														"type": "Copy",
														"dependsOn": [],
														"policy": {
															"timeout": "7.00:00:00",
															"retry": 0,
															"retryIntervalInSeconds": 30,
															"secureOutput": false,
															"secureInput": false
														},
														"userProperties": [
															{
																"name": "Destination",
																"value": "@{item().SchemaName}.@{item().TableName}"
															}
														],
														"typeProperties": {
															"source": {
																"type": "OracleSource",
																"partitionOption": "None",
																"queryTimeout": "02:00:00"
															},
															"sink": {
																"type": "SqlDWSink",
																"preCopyScript": {
																	"value": "TRUNCATE TABLE @{item().SchemaName}.@{item().TableName}",
																	"type": "Expression"
																},
																"disableMetricsCollection": false
															},
															"enableStaging": true,
															"stagingSettings": {
																"linkedServiceName": {
																	"referenceName": "modineerlake",
																	"type": "LinkedServiceReference"
																}
															}
														},
														"inputs": [
															{
																"referenceName": "GloviaProd",
																"type": "DatasetReference",
																"parameters": {
																	"tablename": {
																		"value": "@item().TableName",
																		"type": "Expression"
																	},
																	"schemaname": {
																		"value": "@item().SchemaName",
																		"type": "Expression"
																	}
																}
															}
														],
														"outputs": [
															{
																"referenceName": "AzureSynapseDatabase",
																"type": "DatasetReference",
																"parameters": {
																	"TableName": {
																		"value": "@item().TableName",
																		"type": "Expression"
																	},
																	"DbName": {
																		"value": "@item().DbName",
																		"type": "Expression"
																	},
																	"SchemaName": {
																		"value": "@item().SchemaName",
																		"type": "Expression"
																	}
																}
															}
														]
													}
												]
											}
										],
										"defaultActivities": [
											{
												"name": "Wait1_copy1",
												"type": "Wait",
												"dependsOn": [],
												"userProperties": [],
												"typeProperties": {
													"waitTimeInSeconds": 1
												}
											}
										]
									}
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"folder": {
					"name": "Master Data"
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/Modineer')]",
				"[concat(variables('workspaceId'), '/datasets/GloviaProd')]",
				"[concat(variables('workspaceId'), '/datasets/AzureSynapseDatabase')]",
				"[concat(variables('workspaceId'), '/linkedServices/modineerlake')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/GlobalShopInitial')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "GetTableNames",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "OdbcSource",
								"query": "SELECT * FROM dbo.fSQLTables ('GLOBALMCD', null, null) WHERE TABLE_TYPE LIKE 'TABLE' ORDER BY TABLE_NAME",
								"queryTimeout": "02:00:00"
							},
							"dataset": {
								"referenceName": "OdbcTable2",
								"type": "DatasetReference",
								"parameters": {}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEachTable",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "GetTableNames",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('GetTableNames').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "GS_Table_Copy",
									"type": "Copy",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [
										{
											"name": "Source",
											"value": "@{item().TABLE_NAME}"
										},
										{
											"name": "Destination",
											"value": "@{'globalshop'}/@{item().TABLE_QUALIFIER}/@{concat(item().TABLE_NAME, '.csv')}"
										}
									],
									"typeProperties": {
										"source": {
											"type": "OdbcSource",
											"queryTimeout": "02:00:00"
										},
										"sink": {
											"type": "DelimitedTextSink",
											"storeSettings": {
												"type": "AzureBlobFSWriteSettings"
											},
											"formatSettings": {
												"type": "DelimitedTextWriteSettings",
												"quoteAllText": true,
												"fileExtension": ".txt"
											}
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "GlobalShop_Table",
											"type": "DatasetReference",
											"parameters": {
												"TableName": {
													"value": "@item().TABLE_NAME",
													"type": "Expression"
												}
											}
										}
									],
									"outputs": [
										{
											"referenceName": "SinkCSV",
											"type": "DatasetReference",
											"parameters": {
												"FileSystem": "globalshop",
												"Directory": {
													"value": "@{item().TABLE_QUALIFIER}/@{item().TABLE_NAME}",
													"type": "Expression"
												},
												"FileName": {
													"value": "@{item().TABLE_NAME}.csv",
													"type": "Expression"
												}
											}
										}
									]
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"folder": {
					"name": "Temp"
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/OdbcTable2')]",
				"[concat(variables('workspaceId'), '/datasets/GlobalShop_Table')]",
				"[concat(variables('workspaceId'), '/datasets/SinkCSV')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Glovia Delta Refresh')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Get SCN Number",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "OracleSource",
								"oracleReaderQuery": {
									"value": "@concat('SELECT MAX(ORA_ROWSCN) AS \"SCNValue\" FROM ',pipeline().parameters.Item.SchemaName,'.',pipeline().parameters.Item.TableName)",
									"type": "Expression"
								},
								"partitionOption": "None",
								"queryTimeout": "02:00:00"
							},
							"dataset": {
								"referenceName": "GloviaProd",
								"type": "DatasetReference",
								"parameters": {
									"tablename": {
										"value": "@pipeline().parameters.Item.TableName",
										"type": "Expression"
									},
									"schemaname": {
										"value": "@pipeline().parameters.Item.SchemaName",
										"type": "Expression"
									}
								}
							}
						}
					},
					{
						"name": "Update SCN",
						"type": "SqlPoolStoredProcedure",
						"dependsOn": [
							{
								"activity": "Get SCN Number",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"sqlPool": {
							"referenceName": "Modineer",
							"type": "SqlPoolReference"
						},
						"typeProperties": {
							"storedProcedureName": "[Config].[UpdateSCN]",
							"storedProcedureParameters": {
								"Id": {
									"value": {
										"value": "@pipeline().parameters.Item.Id",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"SCN": {
									"value": {
										"value": "@activity('Get SCN Number').output.firstRow.SCNValue",
										"type": "Expression"
									},
									"type": "Int64"
								}
							}
						}
					},
					{
						"name": "Glovia Raw Data Copy - ADLS2",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "Update SCN",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": true,
							"secureInput": false
						},
						"userProperties": [
							{
								"name": "Source",
								"value": "@{pipeline().parameters.Item.SchemaName}.@{pipeline().parameters.Item.TableName}"
							},
							{
								"name": "Destination",
								"value": "@{pipeline().parameters.Item.FileSystem}/@{concat(pipeline().parameters.Item.SchemaName, '/', pipeline().parameters.Item.TableName, '/', pipeline().parameters.EstDate.firstRow.Year, '/', pipeline().parameters.EstDate.firstRow.Month, '/', pipeline().parameters.EstDate.firstRow.Day)}/@{concat(pipeline().parameters.Item.TableName, '-', pipeline().parameters.EstDate.firstRow.EST, '.parquet')}"
							}
						],
						"typeProperties": {
							"source": {
								"type": "OracleSource",
								"oracleReaderQuery": {
									"value": "SELECT * FROM @{pipeline().parameters.Item.SchemaName}.@{pipeline().parameters.Item.TableName} VERSIONS BETWEEN TIMESTAMP TO_TIMESTAMP(REPLACE(REPLACE('@{addminutes(pipeline().parameters.Item.LastRefreshStart,-15)}','T',' '),'Z',''), 'YYYY-MM-DD HH24:MI:SS.FF') AND CURRENT_TIMESTAMP WHERE versions_operation IN ('D','U','I') AND versions_endtime IS NULL",
									"type": "Expression"
								},
								"partitionOption": "None",
								"queryTimeout": "02:00:00"
							},
							"sink": {
								"type": "ParquetSink",
								"storeSettings": {
									"type": "AzureBlobFSWriteSettings"
								},
								"formatSettings": {
									"type": "ParquetWriteSettings"
								}
							},
							"enableStaging": false
						},
						"inputs": [
							{
								"referenceName": "GloviaProd",
								"type": "DatasetReference",
								"parameters": {
									"tablename": {
										"value": "@pipeline().parameters.Item.TableName",
										"type": "Expression"
									},
									"schemaname": {
										"value": "@pipeline().parameters.Item.SchemaName",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "SinkParquet",
								"type": "DatasetReference",
								"parameters": {
									"file_system": {
										"value": "@pipeline().parameters.Item.FileSystem",
										"type": "Expression"
									},
									"directory": {
										"value": "@{pipeline().parameters.Item.SchemaName}/@{pipeline().parameters.Item.TableName}/@{pipeline().parameters.EstDate.firstRow.Year}/@{pipeline().parameters.EstDate.firstRow.Month}/@{pipeline().parameters.EstDate.firstRow.Day}",
										"type": "Expression"
									},
									"file_name": {
										"value": "@{pipeline().parameters.Item.TableName}-@{pipeline().parameters.EstDate.firstRow.EST}.parquet",
										"type": "Expression"
									}
								}
							}
						]
					},
					{
						"name": "Glovia Raw Data Copy - SQL Pool",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "Update SCN",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": true,
							"secureInput": false
						},
						"userProperties": [
							{
								"name": "Source",
								"value": "@{pipeline().parameters.Item.SchemaName}.@{pipeline().parameters.Item.TableName}"
							},
							{
								"name": "Destination",
								"value": "@{pipeline().parameters.Item.StagingSchema}.@{pipeline().parameters.Item.TableName}"
							}
						],
						"typeProperties": {
							"source": {
								"type": "OracleSource",
								"oracleReaderQuery": {
									"value": "SELECT * FROM @{pipeline().parameters.Item.SchemaName}.@{pipeline().parameters.Item.TableName} VERSIONS BETWEEN TIMESTAMP TO_TIMESTAMP(REPLACE(REPLACE('@{addminutes(pipeline().parameters.Item.LastRefreshStart,-15)}','T',' '),'Z',''), 'YYYY-MM-DD HH24:MI:SS.FF') AND CURRENT_TIMESTAMP WHERE versions_operation IN ('D','U','I') AND versions_endtime IS NULL",
									"type": "Expression"
								},
								"partitionOption": "None",
								"queryTimeout": "02:00:00"
							},
							"sink": {
								"type": "SqlDWSink",
								"preCopyScript": {
									"value": "TRUNCATE TABLE @{pipeline().parameters.Item.StagingSchema}.@{pipeline().parameters.Item.TableName}",
									"type": "Expression"
								},
								"tableOption": "autoCreate",
								"disableMetricsCollection": false
							},
							"enableStaging": false
						},
						"inputs": [
							{
								"referenceName": "GloviaProd",
								"type": "DatasetReference",
								"parameters": {
									"tablename": {
										"value": "@pipeline().parameters.Item.TableName",
										"type": "Expression"
									},
									"schemaname": {
										"value": "@pipeline().parameters.Item.SchemaName",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "AzureSynapseDatabase",
								"type": "DatasetReference",
								"parameters": {
									"TableName": {
										"value": "@pipeline().parameters.Item.TableName",
										"type": "Expression"
									},
									"DbName": {
										"value": "@pipeline().parameters.Item.DbName",
										"type": "Expression"
									},
									"SchemaName": {
										"value": "@pipeline().parameters.Item.StagingSchema",
										"type": "Expression"
									}
								}
							}
						]
					},
					{
						"name": "Glovia Create Table Or Merge Data",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "Glovia Raw Data Copy - SQL Pool",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "Data Merge",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"item": {
									"value": "@pipeline().parameters.Item",
									"type": "Expression"
								},
								"DateData": {
									"value": "@pipeline().parameters.EstDate.firstRow",
									"type": "Expression"
								}
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"Item": {
						"type": "object"
					},
					"EstDate": {
						"type": "object"
					}
				},
				"folder": {
					"name": "Master Data/Slave Pipelines/Glovia Data Refresh"
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/GloviaProd')]",
				"[concat(variables('workspaceId'), '/sqlPools/Modineer')]",
				"[concat(variables('workspaceId'), '/datasets/SinkParquet')]",
				"[concat(variables('workspaceId'), '/datasets/AzureSynapseDatabase')]",
				"[concat(variables('workspaceId'), '/pipelines/Data Merge')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Infor Data Refresh')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Get Data From Infor",
						"description": "Gets the top 2500 rows from Infor and saves it as a .parquet file.",
						"type": "Copy",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": {
									"value": "SELECT TOP 5000 * FROM @{pipeline().parameters.Item.TableName} ORDER BY ROWID DESC",
									"type": "Expression"
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "ParquetSink",
								"storeSettings": {
									"type": "AzureBlobFSWriteSettings"
								},
								"formatSettings": {
									"type": "ParquetWriteSettings"
								}
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "Infor_Visual",
								"type": "DatasetReference",
								"parameters": {
									"table_name": {
										"value": "@pipeline().parameters.Item.TableName",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "SinkParquet",
								"type": "DatasetReference",
								"parameters": {
									"file_system": {
										"value": "@pipeline().parameters.Item.FileSystem",
										"type": "Expression"
									},
									"directory": {
										"value": "@{pipeline().parameters.Item.SchemaName}/@{pipeline().parameters.Item.TableName}/@{pipeline().parameters.EstDate.firstRow.Year}/@{pipeline().parameters.EstDate.firstRow.Month}/@{pipeline().parameters.EstDate.firstRow.Day}",
										"type": "Expression"
									},
									"file_name": {
										"value": "@{pipeline().parameters.Item.TableName}-@{pipeline().parameters.EstDate.Year}-@{pipeline().parameters.EstDate.Month}-@{pipeline().parameters.EstDate.Day}T@{pipeline().parameters.EstDate.Hour}:@{pipeline().parameters.EstDate.Minute}:@{pipeline().parameters.EstDate.Second}.parquet",
										"type": "Expression"
									}
								}
							}
						]
					},
					{
						"name": "Merge Data to Infor Table",
						"description": "Takes the data from the file and merges it with the sql table",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "Get Data From Infor",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "ParquetSource",
								"storeSettings": {
									"type": "AzureBlobFSReadSettings",
									"recursive": true,
									"enablePartitionDiscovery": false
								}
							},
							"sink": {
								"type": "SqlDWSink",
								"writeBehavior": "Upsert",
								"upsertSettings": {
									"keys": {
										"value": "@array('ROWID')",
										"type": "Expression"
									},
									"interimSchemaName": {
										"value": "@pipeline().parameters.Item.SchemaName",
										"type": "Expression"
									}
								},
								"sqlWriterUseTableLock": false,
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "ReadParquet",
								"type": "DatasetReference",
								"parameters": {
									"FileSystem": {
										"value": "@pipeline().parameters.Item.FileSystem",
										"type": "Expression"
									},
									"FilePath": {
										"value": "@{pipeline().parameters.Item.SchemaName}/@{pipeline().parameters.Item.TableName}/@{pipeline().parameters.EstDate.firstRow.Year}/@{pipeline().parameters.EstDate.firstRow.Month}/@{pipeline().parameters.EstDate.firstRow.Day}",
										"type": "Expression"
									},
									"FileName": "@{pipeline().parameters.Item.TableName}-@{pipeline().parameters.EstDate.Year}-@{pipeline().parameters.EstDate.Month}-@{pipeline().parameters.EstDate.Day}T@{pipeline().parameters.EstDate.Hour}:@{pipeline().parameters.EstDate.Minute}:@{pipeline().parameters.EstDate.Second}.parquet"
								}
							}
						],
						"outputs": [
							{
								"referenceName": "AzureSynapseDatabase",
								"type": "DatasetReference",
								"parameters": {
									"TableName": {
										"value": "@pipeline().parameters.Item.TableName",
										"type": "Expression"
									},
									"DbName": {
										"value": "@pipeline().parameters.Item.DbName",
										"type": "Expression"
									},
									"SchemaName": {
										"value": "@pipeline().parameters.Item.SchemaName",
										"type": "Expression"
									}
								}
							}
						]
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"Item": {
						"type": "object"
					},
					"EstDate": {
						"type": "object"
					}
				},
				"folder": {
					"name": "Master Data/Slave Pipelines/Infor Pipelines"
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/Infor_Visual')]",
				"[concat(variables('workspaceId'), '/datasets/SinkParquet')]",
				"[concat(variables('workspaceId'), '/datasets/ReadParquet')]",
				"[concat(variables('workspaceId'), '/datasets/AzureSynapseDatabase')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/InforTest1')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Copy data1",
						"type": "Copy",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "ParquetSink",
								"storeSettings": {
									"type": "AzureBlobFSWriteSettings"
								},
								"formatSettings": {
									"type": "ParquetWriteSettings"
								}
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "Infor_Visual",
								"type": "DatasetReference",
								"parameters": {
									"table_name": {
										"value": "@variables('TableName')",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "SinkParquet",
								"type": "DatasetReference",
								"parameters": {
									"file_system": "unified-data-cluster",
									"directory": "Infor/TestData",
									"file_name": {
										"value": "@{variables('TableName')}.parquet",
										"type": "Expression"
									}
								}
							}
						]
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"variables": {
					"TableName": {
						"type": "String",
						"defaultValue": "RECEIVABLE_LINE"
					}
				},
				"folder": {
					"name": "Pulverman Testing"
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/Infor_Visual')]",
				"[concat(variables('workspaceId'), '/datasets/SinkParquet')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Initial Table Setup')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Get EST Date",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlPoolSource",
								"sqlReaderStoredProcedureName": "[Config].[usp_GetESTDate]",
								"queryTimeout": "02:00:00"
							},
							"dataset": {
								"referenceName": "Modineer",
								"type": "DatasetReference",
								"parameters": {}
							}
						}
					},
					{
						"name": "System Switch",
						"type": "Switch",
						"dependsOn": [
							{
								"activity": "Get EST Date",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"on": {
								"value": "@variables('SchemaName')",
								"type": "Expression"
							},
							"cases": [
								{
									"value": "Netsuite",
									"activities": [
										{
											"name": "Raw Data Copy - ADLS2_copy1",
											"type": "Copy",
											"dependsOn": [],
											"policy": {
												"timeout": "7.00:00:00",
												"retry": 0,
												"retryIntervalInSeconds": 30,
												"secureOutput": true,
												"secureInput": false
											},
											"userProperties": [
												{
													"name": "Source",
													"value": "@{variables('SchemaName')}.@{variables('TableName')}"
												},
												{
													"name": "Destination",
													"value": "@{'unified-data-cluster'}/@{concat(variables('SchemaName'), '/', variables('TableName'), '/', activity('Get EST Date').output.firstRow.Year, '/', activity('Get EST Date').output.firstRow.Month, '/', activity('Get EST Date').output.firstRow.Day)}/@{concat(variables('TableName'), '-', activity('Get EST Date').output.firstRow.EST)}"
												}
											],
											"typeProperties": {
												"source": {
													"type": "OdbcSource",
													"query": {
														"value": "SELECT * FROM @{variables('TableName')}",
														"type": "Expression"
													},
													"queryTimeout": "02:00:00"
												},
												"sink": {
													"type": "ParquetSink",
													"storeSettings": {
														"type": "AzureBlobFSWriteSettings"
													},
													"formatSettings": {
														"type": "ParquetWriteSettings"
													}
												},
												"enableStaging": false
											},
											"inputs": [
												{
													"referenceName": "NetsuiteODBCSource",
													"type": "DatasetReference",
													"parameters": {}
												}
											],
											"outputs": [
												{
													"referenceName": "SinkParquet",
													"type": "DatasetReference",
													"parameters": {
														"file_system": {
															"value": "unified-data-cluster",
															"type": "Expression"
														},
														"directory": {
															"value": "@{variables('SchemaName')}/@{variables('TableName')}/@{activity('Get EST Date').output.firstRow.Year}/@{activity('Get EST Date').output.firstRow.Month}/@{activity('Get EST Date').output.firstRow.Day}",
															"type": "Expression"
														},
														"file_name": {
															"value": "@{variables('TableName')}-Initial Load.parquet",
															"type": "Expression"
														}
													}
												}
											]
										}
									]
								},
								{
									"value": "Plex",
									"activities": [
										{
											"name": "Raw Data Copy - ADLS2",
											"type": "Copy",
											"dependsOn": [],
											"policy": {
												"timeout": "7.00:00:00",
												"retry": 0,
												"retryIntervalInSeconds": 30,
												"secureOutput": true,
												"secureInput": false
											},
											"userProperties": [
												{
													"name": "Source",
													"value": "@{variables('SchemaName')}.@{variables('TableName')}"
												},
												{
													"name": "Destination",
													"value": "@{'unified-data-cluster'}/@{concat(variables('SchemaName'), '/', variables('TableName'), '/', activity('Get EST Date').output.firstRow.Year, '/', activity('Get EST Date').output.firstRow.Month, '/', activity('Get EST Date').output.firstRow.Day)}/@{concat(variables('TableName'), '-', activity('Get EST Date').output.firstRow.EST)}"
												}
											],
											"typeProperties": {
												"source": {
													"type": "OdbcSource",
													"queryTimeout": "02:00:00"
												},
												"sink": {
													"type": "ParquetSink",
													"storeSettings": {
														"type": "AzureBlobFSWriteSettings"
													},
													"formatSettings": {
														"type": "ParquetWriteSettings"
													}
												},
												"enableStaging": false
											},
											"inputs": [
												{
													"referenceName": "PlexODBC",
													"type": "DatasetReference",
													"parameters": {
														"SchemaName": {
															"value": "@variables('SchemaName')",
															"type": "Expression"
														},
														"TableName": {
															"value": "@variables('TableName')",
															"type": "Expression"
														}
													}
												}
											],
											"outputs": [
												{
													"referenceName": "SinkParquet",
													"type": "DatasetReference",
													"parameters": {
														"file_system": {
															"value": "unified-data-cluster",
															"type": "Expression"
														},
														"directory": {
															"value": "@{variables('SchemaName')}/@{variables('TableName')}/@{activity('Get EST Date').output.firstRow.Year}/@{activity('Get EST Date').output.firstRow.Month}/@{activity('Get EST Date').output.firstRow.Day}",
															"type": "Expression"
														},
														"file_name": {
															"value": "@{variables('TableName')}-Initial Load.parquet",
															"type": "Expression"
														}
													}
												}
											]
										}
									]
								},
								{
									"value": "GLOVIA_PROD",
									"activities": [
										{
											"name": "Glovia Raw Data Copy - ADLS2",
											"type": "Copy",
											"dependsOn": [],
											"policy": {
												"timeout": "7.00:00:00",
												"retry": 0,
												"retryIntervalInSeconds": 30,
												"secureOutput": true,
												"secureInput": false
											},
											"userProperties": [],
											"typeProperties": {
												"source": {
													"type": "OracleSource",
													"partitionOption": "None",
													"queryTimeout": "02:00:00"
												},
												"sink": {
													"type": "ParquetSink",
													"storeSettings": {
														"type": "AzureBlobFSWriteSettings"
													},
													"formatSettings": {
														"type": "ParquetWriteSettings"
													}
												},
												"enableStaging": true,
												"stagingSettings": {
													"linkedServiceName": {
														"referenceName": "modineerlake",
														"type": "LinkedServiceReference"
													}
												}
											},
											"inputs": [
												{
													"referenceName": "GloviaProd",
													"type": "DatasetReference",
													"parameters": {
														"tablename": {
															"value": "@variables('TableName')",
															"type": "Expression"
														},
														"schemaname": {
															"value": "@variables('SchemaName')",
															"type": "Expression"
														}
													}
												}
											],
											"outputs": [
												{
													"referenceName": "SinkParquet",
													"type": "DatasetReference",
													"parameters": {
														"file_system": "unified-data-cluster",
														"directory": {
															"value": "@{variables('SchemaName')}/@{variables('TableName')}",
															"type": "Expression"
														},
														"file_name": {
															"value": "@{variables('TableName')}-Initial.parquet",
															"type": "Expression"
														}
													}
												}
											]
										}
									]
								},
								{
									"value": "Infor",
									"activities": [
										{
											"name": "Copy data1",
											"type": "Copy",
											"dependsOn": [],
											"policy": {
												"timeout": "7.00:00:00",
												"retry": 0,
												"retryIntervalInSeconds": 30,
												"secureOutput": false,
												"secureInput": false
											},
											"userProperties": [],
											"typeProperties": {
												"source": {
													"type": "SqlServerSource",
													"queryTimeout": "02:00:00",
													"partitionOption": "None"
												},
												"sink": {
													"type": "ParquetSink",
													"storeSettings": {
														"type": "AzureBlobFSWriteSettings"
													},
													"formatSettings": {
														"type": "ParquetWriteSettings"
													}
												},
												"enableStaging": false,
												"translator": {
													"type": "TabularTranslator",
													"typeConversion": true,
													"typeConversionSettings": {
														"allowDataTruncation": true,
														"treatBooleanAsNumber": false
													}
												}
											},
											"inputs": [
												{
													"referenceName": "Infor_Visual",
													"type": "DatasetReference",
													"parameters": {
														"table_name": {
															"value": "@variables('TableName')",
															"type": "Expression"
														}
													}
												}
											],
											"outputs": [
												{
													"referenceName": "SinkParquet",
													"type": "DatasetReference",
													"parameters": {
														"file_system": "unified-data-cluster",
														"directory": {
															"value": "@{variables('SchemaName')}/@{variables('TableName')}",
															"type": "Expression"
														},
														"file_name": {
															"value": "@{variables('TableName')}-Initial.parquet",
															"type": "Expression"
														}
													}
												}
											]
										}
									]
								}
							],
							"defaultActivities": [
								{
									"name": "Wait1",
									"type": "Wait",
									"dependsOn": [],
									"userProperties": [],
									"typeProperties": {
										"waitTimeInSeconds": 1
									}
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"variables": {
					"TableName": {
						"type": "String",
						"defaultValue": "PART"
					},
					"SchemaName": {
						"type": "String",
						"defaultValue": "Infor"
					}
				},
				"folder": {
					"name": "Temp"
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/Modineer')]",
				"[concat(variables('workspaceId'), '/datasets/NetsuiteODBCSource')]",
				"[concat(variables('workspaceId'), '/datasets/SinkParquet')]",
				"[concat(variables('workspaceId'), '/datasets/PlexODBC')]",
				"[concat(variables('workspaceId'), '/datasets/GloviaProd')]",
				"[concat(variables('workspaceId'), '/datasets/Infor_Visual')]",
				"[concat(variables('workspaceId'), '/linkedServices/modineerlake')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Legacy Netsuite Data Copy')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Get Table Names",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlPoolSource",
								"sqlReaderQuery": "select schema_name(t.schema_id) as schema_name, t.name as table_name, t.create_date, t.modify_date from sys.tables t where schema_name(t.schema_id) = 'dbo' order by schema_name,table_name;",
								"queryTimeout": "02:00:00"
							},
							"dataset": {
								"referenceName": "NetsuiteData",
								"type": "DatasetReference",
								"parameters": {
									"Schema": "does not",
									"TableName": "matter"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach1",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Get Table Names",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Get Table Names').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Copy Table",
									"type": "Copy",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [
										{
											"name": "Source",
											"value": "@{item().schema_name}.@{item().table_name}"
										},
										{
											"name": "Destination",
											"value": "@{'legacy-htm'}/@{item().schema_name}/@{item().table_name}"
										}
									],
									"typeProperties": {
										"source": {
											"type": "SqlPoolSource",
											"queryTimeout": "02:00:00"
										},
										"sink": {
											"type": "DelimitedTextSink",
											"storeSettings": {
												"type": "AzureBlobFSWriteSettings"
											},
											"formatSettings": {
												"type": "DelimitedTextWriteSettings",
												"quoteAllText": true,
												"fileExtension": ".txt"
											}
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "NetsuiteData",
											"type": "DatasetReference",
											"parameters": {
												"Schema": {
													"value": "@item().schema_name",
													"type": "Expression"
												},
												"TableName": {
													"value": "@item().table_name",
													"type": "Expression"
												}
											}
										}
									],
									"outputs": [
										{
											"referenceName": "SinkCSV",
											"type": "DatasetReference",
											"parameters": {
												"FileSystem": "legacy-htm",
												"Directory": {
													"value": "@{item().schema_name}/@{item().table_name}",
													"type": "Expression"
												},
												"FileName": {
													"value": "@{item().table_name}.csv",
													"type": "Expression"
												}
											}
										}
									]
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"folder": {
					"name": "Temp"
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/NetsuiteData')]",
				"[concat(variables('workspaceId'), '/datasets/SinkCSV')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Netsuite Data Refresh')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Data Import Type",
						"type": "Switch",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"on": {
								"value": "@pipeline().parameters.item.ConnectionType",
								"type": "Expression"
							},
							"cases": [
								{
									"value": "ODBC",
									"activities": [
										{
											"name": "Modineer Netsuite ODBC Copy",
											"type": "Copy",
											"dependsOn": [],
											"policy": {
												"timeout": "7.00:00:00",
												"retry": 0,
												"retryIntervalInSeconds": 30,
												"secureOutput": false,
												"secureInput": false
											},
											"userProperties": [],
											"typeProperties": {
												"source": {
													"type": "OdbcSource",
													"query": {
														"value": "@pipeline().parameters.item.DataQuery",
														"type": "Expression"
													},
													"queryTimeout": "02:00:00"
												},
												"sink": {
													"type": "SqlDWSink",
													"preCopyScript": {
														"value": "@{pipeline().parameters.item.PreCopySql}",
														"type": "Expression"
													},
													"disableMetricsCollection": false
												},
												"enableStaging": true,
												"stagingSettings": {
													"linkedServiceName": {
														"referenceName": "modineerlake",
														"type": "LinkedServiceReference"
													}
												},
												"translator": {
													"type": "TabularTranslator",
													"typeConversion": true,
													"typeConversionSettings": {
														"allowDataTruncation": true,
														"treatBooleanAsNumber": false
													}
												}
											},
											"inputs": [
												{
													"referenceName": "NetsuiteODBCSource",
													"type": "DatasetReference",
													"parameters": {}
												}
											],
											"outputs": [
												{
													"referenceName": "AzureSynapseDatabase",
													"type": "DatasetReference",
													"parameters": {
														"TableName": {
															"value": "@pipeline().parameters.item.TableName",
															"type": "Expression"
														},
														"DbName": {
															"value": "@pipeline().parameters.item.DbName",
															"type": "Expression"
														},
														"SchemaName": {
															"value": "@pipeline().parameters.item.SchemaName",
															"type": "Expression"
														}
													}
												}
											]
										}
									]
								},
								{
									"value": "WEB",
									"activities": [
										{
											"name": "Copy From File Cabinet",
											"type": "Copy",
											"dependsOn": [],
											"policy": {
												"timeout": "7.00:00:00",
												"retry": 0,
												"retryIntervalInSeconds": 30,
												"secureOutput": false,
												"secureInput": false
											},
											"userProperties": [],
											"typeProperties": {
												"source": {
													"type": "RestSource",
													"httpRequestTimeout": "00:01:40",
													"requestInterval": "00.00:00:00.010",
													"requestMethod": "GET",
													"paginationRules": {
														"supportRFC5988": "true"
													}
												},
												"sink": {
													"type": "SqlDWSink",
													"preCopyScript": {
														"value": "@{pipeline().parameters.item.PreCopySql}",
														"type": "Expression"
													},
													"allowCopyCommand": true,
													"copyCommandSettings": {},
													"disableMetricsCollection": false
												},
												"enableStaging": true,
												"stagingSettings": {
													"linkedServiceName": {
														"referenceName": "modineerlake",
														"type": "LinkedServiceReference"
													}
												}
											},
											"inputs": [
												{
													"referenceName": "NetsuiteFileCabinet",
													"type": "DatasetReference",
													"parameters": {
														"RelativeURL": {
															"value": "@pipeline().parameters.item.DataQuery",
															"type": "Expression"
														}
													}
												}
											],
											"outputs": [
												{
													"referenceName": "AzureSynapseDatabase",
													"type": "DatasetReference",
													"parameters": {
														"TableName": {
															"value": "@pipeline().parameters.item.TableName",
															"type": "Expression"
														},
														"DbName": {
															"value": "@pipeline().parameters.item.DbName",
															"type": "Expression"
														},
														"SchemaName": {
															"value": "@pipeline().parameters.item.SchemaName",
															"type": "Expression"
														}
													}
												}
											]
										}
									]
								},
								{
									"value": "ODBC2",
									"activities": [
										{
											"name": "Modineer Netsuite Raw Data Copy - Data Lake",
											"type": "Copy",
											"dependsOn": [],
											"policy": {
												"timeout": "7.00:00:00",
												"retry": 0,
												"retryIntervalInSeconds": 30,
												"secureOutput": false,
												"secureInput": false
											},
											"userProperties": [
												{
													"name": "Destination",
													"value": "@{pipeline().parameters.item.FileSystem}/@{concat(pipeline().parameters.item.SchemaName, '/', pipeline().parameters.item.TableName, '/', pipeline().parameters.EstDate.Year, '/', pipeline().parameters.EstDate.Month, '/', pipeline().parameters.EstDate.Day)}/@{concat(pipeline().parameters.item.TableName, '[n].parquet')}"
												}
											],
											"typeProperties": {
												"source": {
													"type": "OdbcSource",
													"query": {
														"value": "SELECT * FROM @{pipeline().parameters.item.TableName} WHERE @{pipeline().parameters.item.DataQuery} >= TO_TIMESTAMP(REPLACE(REPLACE('@{addminutes(pipeline().parameters.item.LastRefreshStart,-15)}','T',' '),'Z',''), 'YYYY-MM-DD HH24:MI:SS.FF')",
														"type": "Expression"
													},
													"queryTimeout": "02:00:00"
												},
												"sink": {
													"type": "ParquetSink",
													"storeSettings": {
														"type": "AzureBlobFSWriteSettings"
													},
													"formatSettings": {
														"type": "ParquetWriteSettings"
													}
												},
												"enableStaging": false,
												"translator": {
													"type": "TabularTranslator",
													"typeConversion": true,
													"typeConversionSettings": {
														"allowDataTruncation": true,
														"treatBooleanAsNumber": false
													}
												}
											},
											"inputs": [
												{
													"referenceName": "NetsuiteODBCSource",
													"type": "DatasetReference",
													"parameters": {}
												}
											],
											"outputs": [
												{
													"referenceName": "SinkParquet",
													"type": "DatasetReference",
													"parameters": {
														"file_system": {
															"value": "@pipeline().parameters.item.FileSystem",
															"type": "Expression"
														},
														"directory": {
															"value": "@{pipeline().parameters.item.SchemaName}/@{pipeline().parameters.item.TableName}/@{pipeline().parameters.EstDate.Year}/@{pipeline().parameters.EstDate.Month}/@{pipeline().parameters.EstDate.Day}",
															"type": "Expression"
														},
														"file_name": {
															"value": "@{pipeline().parameters.item.TableName}[n].parquet",
															"type": "Expression"
														}
													}
												}
											]
										},
										{
											"name": "Modineer Netsuite Raw Data Copy - SQL Pool",
											"type": "Copy",
											"dependsOn": [],
											"policy": {
												"timeout": "7.00:00:00",
												"retry": 0,
												"retryIntervalInSeconds": 30,
												"secureOutput": false,
												"secureInput": false
											},
											"userProperties": [
												{
													"name": "Destination",
													"value": "@{'Delta'}.@{pipeline().parameters.item.TableName}"
												}
											],
											"typeProperties": {
												"source": {
													"type": "OdbcSource",
													"query": {
														"value": "SELECT * FROM @{pipeline().parameters.item.TableName} WHERE @{pipeline().parameters.item.DataQuery} >= TO_TIMESTAMP(REPLACE(REPLACE('@{addminutes(pipeline().parameters.item.LastRefreshStart,-15)}','T',' '),'Z',''), 'YYYY-MM-DD HH24:MI:SS.FF')",
														"type": "Expression"
													},
													"queryTimeout": "02:00:00"
												},
												"sink": {
													"type": "SqlDWSink",
													"preCopyScript": {
														"value": "TRUNCATE TABLE [@{pipeline().parameters.item.StagingSchema}].[@{pipeline().parameters.item.TableName}]",
														"type": "Expression"
													},
													"tableOption": "autoCreate",
													"disableMetricsCollection": false
												},
												"enableStaging": false
											},
											"inputs": [
												{
													"referenceName": "NetsuiteODBCSource",
													"type": "DatasetReference",
													"parameters": {}
												}
											],
											"outputs": [
												{
													"referenceName": "AzureSynapseDatabase",
													"type": "DatasetReference",
													"parameters": {
														"TableName": {
															"value": "@pipeline().parameters.item.TableName",
															"type": "Expression"
														},
														"DbName": {
															"value": "@pipeline().parameters.item.DbName",
															"type": "Expression"
														},
														"SchemaName": {
															"value": "@pipeline().parameters.item.StagingSchema",
															"type": "Expression"
														}
													}
												}
											]
										},
										{
											"name": "Data Merge",
											"type": "ExecutePipeline",
											"dependsOn": [
												{
													"activity": "Modineer Netsuite Raw Data Copy - SQL Pool",
													"dependencyConditions": [
														"Succeeded"
													]
												}
											],
											"userProperties": [],
											"typeProperties": {
												"pipeline": {
													"referenceName": "Data Merge",
													"type": "PipelineReference"
												},
												"waitOnCompletion": true,
												"parameters": {
													"item": {
														"value": "@pipeline().parameters.item",
														"type": "Expression"
													},
													"DateData": {
														"value": "@pipeline().parameters.EstDate",
														"type": "Expression"
													}
												}
											}
										}
									]
								}
							],
							"defaultActivities": [
								{
									"name": "Wait1",
									"description": "This is a placeholder",
									"type": "Wait",
									"dependsOn": [],
									"userProperties": [],
									"typeProperties": {
										"waitTimeInSeconds": 1
									}
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"item": {
						"type": "object"
					},
					"EstDate": {
						"type": "object"
					}
				},
				"folder": {
					"name": "Master Data/Slave Pipelines"
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/NetsuiteODBCSource')]",
				"[concat(variables('workspaceId'), '/datasets/AzureSynapseDatabase')]",
				"[concat(variables('workspaceId'), '/datasets/NetsuiteFileCabinet')]",
				"[concat(variables('workspaceId'), '/datasets/SinkParquet')]",
				"[concat(variables('workspaceId'), '/pipelines/Data Merge')]",
				"[concat(variables('workspaceId'), '/linkedServices/modineerlake')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Netsuite Data Refresh_copy1')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Data Import Type",
						"type": "Switch",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"on": {
								"value": "@pipeline().parameters.item.ConnectionType",
								"type": "Expression"
							},
							"cases": [
								{
									"value": "ODBC",
									"activities": [
										{
											"name": "Modineer Netsuite ODBC Copy",
											"type": "Copy",
											"dependsOn": [],
											"policy": {
												"timeout": "7.00:00:00",
												"retry": 0,
												"retryIntervalInSeconds": 30,
												"secureOutput": false,
												"secureInput": false
											},
											"userProperties": [],
											"typeProperties": {
												"source": {
													"type": "OdbcSource",
													"query": {
														"value": "@pipeline().parameters.item.DataQuery",
														"type": "Expression"
													},
													"queryTimeout": "02:00:00"
												},
												"sink": {
													"type": "SqlDWSink",
													"preCopyScript": {
														"value": "@{concat('TRUNCATE TABLE ',pipeline().parameters.item.SchemaName,'.',pipeline().parameters.item.TableName)}",
														"type": "Expression"
													},
													"disableMetricsCollection": false
												},
												"enableStaging": false,
												"translator": {
													"type": "TabularTranslator",
													"typeConversion": true,
													"typeConversionSettings": {
														"allowDataTruncation": true,
														"treatBooleanAsNumber": false
													}
												}
											},
											"inputs": [
												{
													"referenceName": "NetsuiteODBCSource",
													"type": "DatasetReference",
													"parameters": {}
												}
											],
											"outputs": [
												{
													"referenceName": "AzureSynapseDatabase",
													"type": "DatasetReference",
													"parameters": {
														"TableName": {
															"value": "@pipeline().parameters.item.TableName",
															"type": "Expression"
														},
														"DbName": {
															"value": "@pipeline().parameters.item.DbName",
															"type": "Expression"
														},
														"SchemaName": {
															"value": "@pipeline().parameters.item.SchemaName",
															"type": "Expression"
														}
													}
												}
											]
										}
									]
								}
							],
							"defaultActivities": [
								{
									"name": "Wait1",
									"description": "This is a placeholder",
									"type": "Wait",
									"dependsOn": [],
									"userProperties": [],
									"typeProperties": {
										"waitTimeInSeconds": 1
									}
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"item": {
						"type": "object"
					}
				},
				"folder": {
					"name": "Serverless Setup/Slave Pipeline"
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/NetsuiteODBCSource')]",
				"[concat(variables('workspaceId'), '/datasets/AzureSynapseDatabase')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Plex Data Refresh - Data Count')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Connection Type",
						"type": "Switch",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"on": {
								"value": "@pipeline().parameters.item.ConnectionType",
								"type": "Expression"
							},
							"cases": [
								{
									"value": "ODBC",
									"activities": [
										{
											"name": "Check For Processing",
											"type": "Lookup",
											"dependsOn": [],
											"policy": {
												"timeout": "7.00:00:00",
												"retry": 0,
												"retryIntervalInSeconds": 30,
												"secureOutput": false,
												"secureInput": false
											},
											"userProperties": [],
											"typeProperties": {
												"source": {
													"type": "OdbcSource",
													"query": {
														"value": "SELECT COUNT(*) AS Count FROM @{pipeline().parameters.item.SchemaName}.@{pipeline().parameters.item.TableName} t1 WHERE @{pipeline().parameters.item.DataQuery} >= CAST('@{pipeline().parameters.item.LastRefreshStart}' AS DATE)",
														"type": "Expression"
													},
													"queryTimeout": "02:00:00"
												},
												"dataset": {
													"referenceName": "PlexODBC",
													"type": "DatasetReference",
													"parameters": {
														"SchemaName": {
															"value": "@pipeline().parameters.item.SchemaName",
															"type": "Expression"
														},
														"TableName": {
															"value": "@pipeline().parameters.item.TableName",
															"type": "Expression"
														}
													}
												}
											}
										},
										{
											"name": "PDR - Process",
											"type": "ExecutePipeline",
											"dependsOn": [
												{
													"activity": "Check For Processing",
													"dependencyConditions": [
														"Succeeded"
													]
												}
											],
											"userProperties": [],
											"typeProperties": {
												"pipeline": {
													"referenceName": "Plex Data Refresh - Process",
													"type": "PipelineReference"
												},
												"waitOnCompletion": true,
												"parameters": {
													"item": {
														"value": "@pipeline().parameters.item",
														"type": "Expression"
													},
													"DataCount": {
														"value": "@activity('Check For Processing').output.firstRow.Count",
														"type": "Expression"
													},
													"EstDate": {
														"value": "@pipeline().parameters.EstDate",
														"type": "Expression"
													}
												}
											}
										}
									]
								}
							],
							"defaultActivities": [
								{
									"name": "Wait2",
									"type": "Wait",
									"dependsOn": [],
									"userProperties": [],
									"typeProperties": {
										"waitTimeInSeconds": 1
									}
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"item": {
						"type": "object"
					},
					"EstDate": {
						"type": "object"
					}
				},
				"folder": {
					"name": "Master Data/Slave Pipelines/Plex Data Refresh"
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/PlexODBC')]",
				"[concat(variables('workspaceId'), '/pipelines/Plex Data Refresh - Process')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Plex Data Refresh - Process')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Count of Changed Rows",
						"type": "IfCondition",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"expression": {
								"value": "@greater(pipeline().parameters.DataCount,0)",
								"type": "Expression"
							},
							"ifFalseActivities": [
								{
									"name": "Wait1_copy1",
									"type": "Wait",
									"dependsOn": [],
									"userProperties": [],
									"typeProperties": {
										"waitTimeInSeconds": 1
									}
								}
							],
							"ifTrueActivities": [
								{
									"name": "Plex Raw Data Copy - SQL Pool",
									"type": "Copy",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": true,
										"secureInput": false
									},
									"userProperties": [
										{
											"name": "Source",
											"value": "@{pipeline().parameters.item.SchemaName}.@{pipeline().parameters.item.TableName}"
										},
										{
											"name": "Destination",
											"value": "@{'Delta'}.@{pipeline().parameters.item.TableName}"
										}
									],
									"typeProperties": {
										"source": {
											"type": "OdbcSource",
											"query": {
												"value": "SELECT * FROM @{pipeline().parameters.item.SchemaName}.@{pipeline().parameters.item.TableName} t1 WHERE @{pipeline().parameters.item.DataQuery} >= CAST('@{pipeline().parameters.item.LastRefreshStart}' AS DATE)",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00"
										},
										"sink": {
											"type": "SqlDWSink",
											"preCopyScript": {
												"value": "TRUNCATE TABLE @{pipeline().parameters.item.StagingSchema}.@{pipeline().parameters.item.TableName}",
												"type": "Expression"
											},
											"tableOption": "autoCreate",
											"disableMetricsCollection": false
										},
										"enableStaging": false
									},
									"inputs": [
										{
											"referenceName": "PlexODBC",
											"type": "DatasetReference",
											"parameters": {
												"SchemaName": {
													"value": "@pipeline().parameters.item.SchemaName",
													"type": "Expression"
												},
												"TableName": {
													"value": "@pipeline().parameters.item.TableName",
													"type": "Expression"
												}
											}
										}
									],
									"outputs": [
										{
											"referenceName": "AzureSynapseDatabase",
											"type": "DatasetReference",
											"parameters": {
												"TableName": {
													"value": "@pipeline().parameters.item.TableName",
													"type": "Expression"
												},
												"DbName": {
													"value": "@pipeline().parameters.item.DbName",
													"type": "Expression"
												},
												"SchemaName": {
													"value": "@pipeline().parameters.item.StagingSchema",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Plex Create Table Or Merge Data",
									"type": "ExecutePipeline",
									"dependsOn": [
										{
											"activity": "Plex Raw Data Copy - SQL Pool",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "Data Merge",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"item": {
												"value": "@pipeline().parameters.item",
												"type": "Expression"
											},
											"DateData": {
												"value": "@pipeline().parameters.EstDate",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "Plex Raw Data Copy - ADLS2",
									"type": "Copy",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": true,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "OdbcSource",
											"query": {
												"value": "SELECT * FROM @{pipeline().parameters.item.SchemaName}.@{pipeline().parameters.item.TableName} t1 WHERE @{pipeline().parameters.item.DataQuery} >= CAST('@{pipeline().parameters.item.LastRefreshStart}' AS DATE)",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00"
										},
										"sink": {
											"type": "ParquetSink",
											"storeSettings": {
												"type": "AzureBlobFSWriteSettings"
											},
											"formatSettings": {
												"type": "ParquetWriteSettings"
											}
										},
										"enableStaging": false
									},
									"inputs": [
										{
											"referenceName": "PlexODBC",
											"type": "DatasetReference",
											"parameters": {
												"SchemaName": {
													"value": "@pipeline().parameters.item.SchemaName",
													"type": "Expression"
												},
												"TableName": {
													"value": "@pipeline().parameters.item.TableName",
													"type": "Expression"
												}
											}
										}
									],
									"outputs": [
										{
											"referenceName": "SinkParquet",
											"type": "DatasetReference",
											"parameters": {
												"file_system": {
													"value": "@pipeline().parameters.item.FileSystem",
													"type": "Expression"
												},
												"directory": {
													"value": "@{pipeline().parameters.item.SchemaName}/@{pipeline().parameters.item.TableName}/@{pipeline().parameters.EstDate.firstRow.Year}/@{pipeline().parameters.EstDate.firstRow.Month}/@{pipeline().parameters.EstDate.firstRow.Day}",
													"type": "Expression"
												},
												"file_name": {
													"value": "@{pipeline().parameters.item.TableName}-@{pipeline().parameters.EstDate.firstRow.EST}",
													"type": "Expression"
												}
											}
										}
									]
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"item": {
						"type": "object"
					},
					"DataCount": {
						"type": "int"
					},
					"EstDate": {
						"type": "object"
					}
				},
				"folder": {
					"name": "Master Data/Slave Pipelines/Plex Data Refresh"
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/PlexODBC')]",
				"[concat(variables('workspaceId'), '/datasets/AzureSynapseDatabase')]",
				"[concat(variables('workspaceId'), '/pipelines/Data Merge')]",
				"[concat(variables('workspaceId'), '/datasets/SinkParquet')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/AzureSynapseDatabase')]",
			"type": "Microsoft.Synapse/workspaces/datasets",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"linkedServiceName": {
					"referenceName": "modineerworkspace-WorkspaceDefaultSqlServer",
					"type": "LinkedServiceReference",
					"parameters": {
						"DBName": {
							"value": "@dataset().DbName",
							"type": "Expression"
						}
					}
				},
				"parameters": {
					"TableName": {
						"type": "string"
					},
					"DbName": {
						"type": "string"
					},
					"SchemaName": {
						"type": "string"
					}
				},
				"annotations": [],
				"type": "AzureSqlDWTable",
				"schema": [],
				"typeProperties": {
					"schema": {
						"value": "@dataset().SchemaName",
						"type": "Expression"
					},
					"table": {
						"value": "@dataset().TableName",
						"type": "Expression"
					}
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/modineerworkspace-WorkspaceDefaultSqlServer')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/GetCsvFromDataLake')]",
			"type": "Microsoft.Synapse/workspaces/datasets",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"linkedServiceName": {
					"referenceName": "modineerlake",
					"type": "LinkedServiceReference"
				},
				"parameters": {
					"FileSystem": {
						"type": "string"
					},
					"Directory": {
						"type": "string"
					}
				},
				"annotations": [],
				"type": "DelimitedText",
				"typeProperties": {
					"location": {
						"type": "AzureBlobFSLocation"
					},
					"columnDelimiter": ",",
					"escapeChar": "\\",
					"firstRowAsHeader": true,
					"quoteChar": "\""
				},
				"schema": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/modineerlake')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/GlobalShop_Table')]",
			"type": "Microsoft.Synapse/workspaces/datasets",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"linkedServiceName": {
					"referenceName": "GlobalShopData",
					"type": "LinkedServiceReference"
				},
				"parameters": {
					"TableName": {
						"type": "string"
					}
				},
				"annotations": [],
				"type": "OdbcTable",
				"schema": [],
				"typeProperties": {
					"tableName": {
						"value": "@dataset().TableName",
						"type": "Expression"
					}
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/GlobalShopData')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/GloviaProd')]",
			"type": "Microsoft.Synapse/workspaces/datasets",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"linkedServiceName": {
					"referenceName": "GloviaData",
					"type": "LinkedServiceReference"
				},
				"parameters": {
					"tablename": {
						"type": "string"
					},
					"schemaname": {
						"type": "string"
					}
				},
				"annotations": [],
				"type": "OracleTable",
				"schema": [],
				"typeProperties": {
					"schema": {
						"value": "@dataset().schemaname",
						"type": "Expression"
					},
					"table": {
						"value": "@dataset().tablename",
						"type": "Expression"
					}
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/GloviaData')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Infor_Visual')]",
			"type": "Microsoft.Synapse/workspaces/datasets",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"linkedServiceName": {
					"referenceName": "Infor",
					"type": "LinkedServiceReference"
				},
				"parameters": {
					"table_name": {
						"type": "string"
					}
				},
				"annotations": [],
				"type": "SqlServerTable",
				"schema": [],
				"typeProperties": {
					"schema": "dbo",
					"table": {
						"value": "@dataset().table_name",
						"type": "Expression"
					}
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/Infor')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Modineer')]",
			"type": "Microsoft.Synapse/workspaces/datasets",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "SqlPoolTable",
				"schema": [],
				"typeProperties": {},
				"sqlPool": {
					"referenceName": "Modineer",
					"type": "SqlPoolReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/sqlPools/Modineer')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/NetsuiteData')]",
			"type": "Microsoft.Synapse/workspaces/datasets",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"parameters": {
					"Schema": {
						"type": "string"
					},
					"TableName": {
						"type": "string"
					}
				},
				"annotations": [],
				"type": "SqlPoolTable",
				"schema": [],
				"typeProperties": {
					"schema": {
						"value": "@dataset().Schema",
						"type": "Expression"
					},
					"table": {
						"value": "@dataset().TableName",
						"type": "Expression"
					}
				},
				"sqlPool": {
					"referenceName": "NetsuiteData",
					"type": "SqlPoolReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/sqlPools/NetsuiteData')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/NetsuiteFileCabinet')]",
			"type": "Microsoft.Synapse/workspaces/datasets",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"linkedServiceName": {
					"referenceName": "NetsuiteUnAuthorized",
					"type": "LinkedServiceReference"
				},
				"parameters": {
					"RelativeURL": {
						"type": "string"
					}
				},
				"annotations": [],
				"type": "RestResource",
				"typeProperties": {
					"relativeUrl": {
						"value": "@dataset().RelativeURL",
						"type": "Expression"
					}
				},
				"schema": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/NetsuiteUnAuthorized')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/NetsuiteODBCSource')]",
			"type": "Microsoft.Synapse/workspaces/datasets",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"linkedServiceName": {
					"referenceName": "NetsuiteODBC",
					"type": "LinkedServiceReference"
				},
				"annotations": [],
				"type": "OdbcTable",
				"schema": [],
				"typeProperties": {}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/NetsuiteODBC')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/OdbcTable2')]",
			"type": "Microsoft.Synapse/workspaces/datasets",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"linkedServiceName": {
					"referenceName": "GlobalShopData",
					"type": "LinkedServiceReference"
				},
				"annotations": [],
				"type": "OdbcTable",
				"schema": [],
				"typeProperties": {}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/GlobalShopData')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PlexODBC')]",
			"type": "Microsoft.Synapse/workspaces/datasets",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"linkedServiceName": {
					"referenceName": "PlexODBC_LS",
					"type": "LinkedServiceReference"
				},
				"parameters": {
					"SchemaName": {
						"type": "string"
					},
					"TableName": {
						"type": "string"
					}
				},
				"annotations": [],
				"type": "OdbcTable",
				"schema": [],
				"typeProperties": {
					"tableName": {
						"value": "@{dataset().SchemaName}.@{dataset().TableName}",
						"type": "Expression"
					}
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/PlexODBC_LS')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/ReadParquet')]",
			"type": "Microsoft.Synapse/workspaces/datasets",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"linkedServiceName": {
					"referenceName": "modineerlake",
					"type": "LinkedServiceReference"
				},
				"parameters": {
					"FileSystem": {
						"type": "string"
					},
					"FilePath": {
						"type": "string"
					},
					"FileName": {
						"type": "string"
					}
				},
				"annotations": [],
				"type": "Parquet",
				"typeProperties": {
					"location": {
						"type": "AzureBlobFSLocation",
						"fileName": {
							"value": "@dataset().FileName",
							"type": "Expression"
						},
						"folderPath": {
							"value": "@dataset().FilePath",
							"type": "Expression"
						},
						"fileSystem": {
							"value": "@dataset().FileSystem",
							"type": "Expression"
						}
					},
					"compressionCodec": "snappy"
				},
				"schema": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/modineerlake')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/SalesOrderCommonDatasetJSON')]",
			"type": "Microsoft.Synapse/workspaces/datasets",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "Connection to your Azure Data Lake Store",
				"linkedServiceName": {
					"referenceName": "modineerworkspace-WorkspaceDefaultStorage",
					"type": "LinkedServiceReference"
				},
				"parameters": {
					"Container": {
						"type": "string",
						"defaultValue": "unified-data-cluster"
					},
					"Directory": {
						"type": "string",
						"defaultValue": "sales-order-data"
					}
				},
				"annotations": [],
				"type": "Json",
				"typeProperties": {
					"location": {
						"type": "AzureBlobFSLocation",
						"fileName": "HTMSalesOrders.json",
						"folderPath": {
							"value": "@dataset().Directory",
							"type": "Expression"
						},
						"fileSystem": {
							"value": "@dataset().Container",
							"type": "Expression"
						}
					},
					"encodingName": "UTF-8"
				},
				"schema": {
					"type": "object",
					"properties": {
						"subsidiary": {
							"type": "string"
						},
						"transNumber": {
							"type": "string"
						},
						"customer": {
							"type": "string"
						},
						"tranDate": {
							"type": "string"
						},
						"poNum": {
							"type": "string"
						},
						"shipComplete": {
							"type": "boolean"
						},
						"requestedShipDate": {
							"type": "string"
						},
						"actualShipDate": {
							"type": "string"
						},
						"item": {
							"type": "string"
						},
						"amount": {
							"type": "string"
						},
						"quantity": {
							"type": "string"
						}
					}
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/modineerworkspace-WorkspaceDefaultStorage')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/SinkCSV')]",
			"type": "Microsoft.Synapse/workspaces/datasets",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"linkedServiceName": {
					"referenceName": "modineerlake",
					"type": "LinkedServiceReference"
				},
				"parameters": {
					"FileSystem": {
						"type": "string"
					},
					"Directory": {
						"type": "string"
					},
					"FileName": {
						"type": "string"
					}
				},
				"annotations": [],
				"type": "DelimitedText",
				"typeProperties": {
					"location": {
						"type": "AzureBlobFSLocation",
						"fileName": {
							"value": "@dataset().FileName",
							"type": "Expression"
						},
						"folderPath": {
							"value": "@dataset().Directory",
							"type": "Expression"
						},
						"fileSystem": {
							"value": "@dataset().FileSystem",
							"type": "Expression"
						}
					},
					"columnDelimiter": ",",
					"escapeChar": "\\",
					"firstRowAsHeader": true,
					"quoteChar": "\""
				},
				"schema": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/modineerlake')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/SinkParquet')]",
			"type": "Microsoft.Synapse/workspaces/datasets",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"linkedServiceName": {
					"referenceName": "modineerlake",
					"type": "LinkedServiceReference"
				},
				"parameters": {
					"file_system": {
						"type": "string"
					},
					"directory": {
						"type": "string"
					},
					"file_name": {
						"type": "string"
					}
				},
				"annotations": [],
				"type": "Parquet",
				"typeProperties": {
					"location": {
						"type": "AzureBlobFSLocation",
						"fileName": {
							"value": "@dataset().file_name",
							"type": "Expression"
						},
						"folderPath": {
							"value": "@dataset().directory",
							"type": "Expression"
						},
						"fileSystem": {
							"value": "@dataset().file_system",
							"type": "Expression"
						}
					},
					"compressionCodec": "snappy"
				},
				"schema": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/modineerlake')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/htmSalesOrderHeader')]",
			"type": "Microsoft.Synapse/workspaces/datasets",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "SqlPoolTable",
				"schema": [
					{
						"name": "abbrevtype",
						"type": "nvarchar"
					},
					{
						"name": "actualshipdate",
						"type": "date"
					},
					{
						"name": "balsegstatus",
						"type": "bit"
					},
					{
						"name": "billingaddress",
						"type": "int",
						"precision": 10
					},
					{
						"name": "billingstatus",
						"type": "bit"
					},
					{
						"name": "closedate",
						"type": "date"
					},
					{
						"name": "createdby",
						"type": "int",
						"precision": 10
					},
					{
						"name": "createddate",
						"type": "date"
					},
					{
						"name": "currency",
						"type": "int",
						"precision": 10
					},
					{
						"name": "custbodyht_asaporder_bodyfield",
						"type": "bit"
					},
					{
						"name": "custbodyht_boltobeprinted_tranbdy",
						"type": "bit"
					},
					{
						"name": "custbodyht_confirmto",
						"type": "nvarchar"
					},
					{
						"name": "custbodyht_customerscustomerpo_bdfield",
						"type": "int",
						"precision": 10
					},
					{
						"name": "custbodyht_ishistoricaltransaction",
						"type": "bit"
					},
					{
						"name": "custbodyht_numofshiplabelstoprint",
						"type": "int",
						"precision": 10
					},
					{
						"name": "custbodyht_ordersfulyscheduled_tranbdy",
						"type": "bit"
					},
					{
						"name": "custbodyht_shipper",
						"type": "nvarchar"
					},
					{
						"name": "custbodyhtfreightchargepreferences",
						"type": "int",
						"precision": 10
					},
					{
						"name": "custbodyhthaschangeorders",
						"type": "bit"
					},
					{
						"name": "custbodyhtproductiondate",
						"type": "date"
					},
					{
						"name": "daysopen",
						"type": "float",
						"precision": 15
					},
					{
						"name": "email",
						"type": "nvarchar"
					},
					{
						"name": "entity",
						"type": "int",
						"precision": 10
					},
					{
						"name": "exchangerate",
						"type": "int",
						"precision": 10
					},
					{
						"name": "fax",
						"type": "nvarchar"
					},
					{
						"name": "foreigntotal",
						"type": "decimal",
						"precision": 25,
						"scale": 4
					},
					{
						"name": "id",
						"type": "smallint",
						"precision": 5
					},
					{
						"name": "includeinforecast",
						"type": "bit"
					},
					{
						"name": "isfinchrg",
						"type": "bit"
					},
					{
						"name": "isreversal",
						"type": "bit"
					},
					{
						"name": "lastmodifiedby",
						"type": "smallint",
						"precision": 5
					},
					{
						"name": "lastmodifieddate",
						"type": "date"
					},
					{
						"name": "memo",
						"type": "nvarchar"
					},
					{
						"name": "nexus",
						"type": "int",
						"precision": 10
					},
					{
						"name": "number",
						"type": "int",
						"precision": 10
					},
					{
						"name": "ordpicked",
						"type": "bit"
					},
					{
						"name": "paymenthold",
						"type": "bit"
					},
					{
						"name": "posting",
						"type": "bit"
					},
					{
						"name": "printedpickingticket",
						"type": "bit"
					},
					{
						"name": "recordtype",
						"type": "nvarchar"
					},
					{
						"name": "shipcomplete",
						"type": "bit"
					},
					{
						"name": "shipdate",
						"type": "date"
					},
					{
						"name": "shippingaddress",
						"type": "int",
						"precision": 10
					},
					{
						"name": "source",
						"type": "nvarchar"
					},
					{
						"name": "status",
						"type": "char"
					},
					{
						"name": "terms",
						"type": "smallint",
						"precision": 5
					},
					{
						"name": "trandate",
						"type": "date"
					},
					{
						"name": "trandisplayname",
						"type": "nvarchar"
					},
					{
						"name": "tranid",
						"type": "nvarchar"
					},
					{
						"name": "transactionnumber",
						"type": "nvarchar"
					},
					{
						"name": "type",
						"type": "nvarchar"
					},
					{
						"name": "typebaseddocumentnumber",
						"type": "nvarchar"
					},
					{
						"name": "userevenuearrangement",
						"type": "bit"
					},
					{
						"name": "visibletocustomer",
						"type": "bit"
					},
					{
						"name": "void",
						"type": "bit"
					},
					{
						"name": "voided",
						"type": "bit"
					}
				],
				"typeProperties": {
					"schema": "htm",
					"table": "SalesOrderHeader"
				},
				"sqlPool": {
					"referenceName": "NetsuiteData",
					"type": "SqlPoolReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/sqlPools/NetsuiteData')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/GlobalShopData')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "Odbc",
				"typeProperties": {
					"connectionString": {
						"type": "SecureString",
						"value": "[parameters('GlobalShopData_connectionString')]"
					},
					"authenticationType": "Basic",
					"userName": "[parameters('GlobalShopData_properties_typeProperties_userName')]",
					"password": {
						"type": "SecureString",
						"value": "[parameters('GlobalShopData_password')]"
					}
				},
				"connectVia": {
					"referenceName": "GlobalShop",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/GlobalShop')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Glovia Reports')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "PowerBIWorkspace",
				"typeProperties": {
					"workspaceID": "07766c8f-f1c7-4227-a8e4-05b81ad1d804",
					"tenantID": "ea956f36-77a0-4634-9b11-803ca2beeac1"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/GloviaData')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "Access to the Oracle server through a self hosted runtime.",
				"annotations": [],
				"type": "Oracle",
				"typeProperties": {
					"connectionString": "[parameters('GloviaData_connectionString')]"
				},
				"connectVia": {
					"referenceName": "GloviaServerIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/GloviaServerIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/HTM_NetSuite')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "Service for HTM NetSuite",
				"annotations": [],
				"type": "RestService",
				"typeProperties": {
					"url": "[parameters('HTM_NetSuite_properties_typeProperties_url')]",
					"enableServerCertificateValidation": true,
					"authenticationType": "Basic",
					"userName": "[parameters('HTM_NetSuite_properties_typeProperties_userName')]",
					"password": {
						"type": "SecureString",
						"value": "[parameters('HTM_NetSuite_password')]"
					}
				},
				"connectVia": {
					"referenceName": "AutoResolveIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Infor')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "Infor Visual at Pulverman",
				"annotations": [],
				"type": "SqlServer",
				"typeProperties": {
					"connectionString": "[parameters('Infor_connectionString')]"
				},
				"connectVia": {
					"referenceName": "Infor-Pulverman",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/Infor-Pulverman')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Legacy HTM Netsuite Refresh Token')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"parameters": {
					"account_id": {
						"type": "String",
						"defaultValue": "3675944"
					}
				},
				"annotations": [],
				"type": "RestService",
				"typeProperties": {
					"url": "[parameters('Legacy HTM Netsuite Refresh Token_properties_typeProperties_url')]",
					"enableServerCertificateValidation": true,
					"authenticationType": "Basic",
					"userName": "[parameters('Legacy HTM Netsuite Refresh Token_properties_typeProperties_userName')]",
					"password": {
						"type": "SecureString",
						"value": "[parameters('Legacy HTM Netsuite Refresh Token_password')]"
					}
				},
				"connectVia": {
					"referenceName": "AutoResolveIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/ModineerSQLPool')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "AzureSqlDW",
				"typeProperties": {
					"connectionString": "[parameters('ModineerSQLPool_connectionString')]"
				},
				"connectVia": {
					"referenceName": "AutoResolveIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/ModineerTableStorage')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "AzureTableStorage",
				"typeProperties": {
					"connectionString": "[parameters('ModineerTableStorage_connectionString')]"
				},
				"connectVia": {
					"referenceName": "AutoResolveIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Netsuite SuiteQL')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"parameters": {
					"accountid": {
						"type": "String"
					}
				},
				"annotations": [],
				"type": "RestService",
				"typeProperties": {
					"url": "[parameters('Netsuite SuiteQL_properties_typeProperties_url')]",
					"enableServerCertificateValidation": false,
					"authenticationType": "Anonymous"
				},
				"connectVia": {
					"referenceName": "AutoResolveIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/NetsuiteODBC')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "64 bit driver installed on svm02eset001",
				"annotations": [],
				"type": "Odbc",
				"typeProperties": {
					"connectionString": {
						"type": "SecureString",
						"value": "[parameters('NetsuiteODBC_connectionString')]"
					},
					"authenticationType": "Basic",
					"userName": "[parameters('NetsuiteODBC_properties_typeProperties_userName')]",
					"password": {
						"type": "SecureString",
						"value": "[parameters('NetsuiteODBC_password')]"
					}
				},
				"connectVia": {
					"referenceName": "GloviaServerIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/GloviaServerIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/NetsuiteUnAuthorized')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "RestService",
				"typeProperties": {
					"url": "[parameters('NetsuiteUnAuthorized_properties_typeProperties_url')]",
					"enableServerCertificateValidation": true,
					"authenticationType": "Anonymous"
				},
				"connectVia": {
					"referenceName": "AutoResolveIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PlexODBC_LS')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "Odbc",
				"typeProperties": {
					"connectionString": {
						"type": "SecureString",
						"value": "[parameters('PlexODBC_LS_connectionString')]"
					},
					"authenticationType": "Anonymous"
				},
				"connectVia": {
					"referenceName": "GloviaServerIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/GloviaServerIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/modineerlake')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "AzureBlobFS",
				"typeProperties": {
					"url": "[parameters('modineerlake_properties_typeProperties_url')]"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/modineerworkspace-WorkspaceDefaultSqlServer')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"parameters": {
					"DBName": {
						"type": "String"
					}
				},
				"annotations": [],
				"type": "AzureSqlDW",
				"typeProperties": {
					"connectionString": "[parameters('modineerworkspace-WorkspaceDefaultSqlServer_connectionString')]"
				},
				"connectVia": {
					"referenceName": "AutoResolveIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/modineerworkspace-WorkspaceDefaultStorage')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "AzureBlobFS",
				"typeProperties": {
					"url": "[parameters('modineerworkspace-WorkspaceDefaultStorage_properties_typeProperties_url')]"
				},
				"connectVia": {
					"referenceName": "AutoResolveIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Data Refresh Trigger')]",
			"type": "Microsoft.Synapse/workspaces/triggers",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"runtimeState": "Started",
				"pipelines": [
					{
						"pipelineReference": {
							"referenceName": "Data Refresh Delta",
							"type": "PipelineReference"
						},
						"parameters": {}
					}
				],
				"type": "ScheduleTrigger",
				"typeProperties": {
					"recurrence": {
						"frequency": "Minute",
						"interval": 15,
						"startTime": "2021-10-27T11:00:00",
						"timeZone": "Eastern Standard Time"
					}
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/pipelines/Data Refresh Delta')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/AutoResolveIntegrationRuntime')]",
			"type": "Microsoft.Synapse/workspaces/integrationRuntimes",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "Managed",
				"typeProperties": {
					"computeProperties": {
						"location": "AutoResolve",
						"dataFlowProperties": {
							"computeType": "General",
							"coreCount": 8,
							"timeToLive": 0
						}
					}
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/GlobalShop')]",
			"type": "Microsoft.Synapse/workspaces/integrationRuntimes",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "SelfHosted",
				"typeProperties": {}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/GloviaServerIntegrationRuntime')]",
			"type": "Microsoft.Synapse/workspaces/integrationRuntimes",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "SelfHosted",
				"description": "Integration runtime for the Glovia Server.\nRuntime to connect the Netsuite ODBC to to synapse.",
				"typeProperties": {}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Infor-Pulverman')]",
			"type": "Microsoft.Synapse/workspaces/integrationRuntimes",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "SelfHosted",
				"description": "Data access to Pulverman Infor Visual ERP",
				"typeProperties": {}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/WorkspaceSystemIdentity')]",
			"type": "Microsoft.Synapse/workspaces/credentials",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "ManagedIdentity",
				"typeProperties": {}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Add Table To Refresh')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"folder": {
					"name": "General"
				},
				"content": {
					"query": "EXEC Config.AddTableToRefresh \n'GloviaProd',--RowGroup\n'Modineer', --DBName\n'GLOVIA_PROD', --SchemaName\n'CO_ITEM', --TableName\n'unified-data-cluster', --FileSystem\n'CCN,PUR_CCN,MAS_LOC,ITEM,REVISION,CO_HDR_ORD_STATUS,CO_NUM,CO_LINE', --TableKeysArray\nNULL, --ConnectionType\nNULL, --DataQuery\n0, --CurrentProcess\nNULL, --TableMaxSCN\n'MINUTE', --RefreshInterval\n15, --RefreshNumber\n'GDelta' --StagingSchema",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "Modineer",
						"poolName": "Modineer"
					},
					"resultLimit": 5000
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Delete Duplicates')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "Takes table name and key columns to remove duplicates from non-hash partitioned tables.",
				"folder": {
					"name": "Maintenance"
				},
				"content": {
					"query": "DECLARE @tablname nvarchar(50)\nSET @tablname = 'GLOVIA_PROD.WO'\n\nDELETE FROM @tablename\nWHERE CONCAT(CCN,MAS_LOC,WO_NUM,WO_LINE) IN (SELECT id\nFROM (SELECT CONCAT(CCN,MAS_LOC,WO_NUM,WO_LINE) AS id,\n    ROW_NUMBER() OVER(PARTITION BY CCN,MAS_LOC,WO_NUM,WO_LINE ORDER BY CCN,MAS_LOC,WO_NUM,WO_LINE) AS rnum\n    FROM @tablename)t\n    WHERE t.rnum > 1);",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "master",
						"poolName": "Built-in"
					},
					"resultLimit": 5000
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/DynamicSQLMerge')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"folder": {
					"name": "General"
				},
				"content": {
					"query": "CREATE PROCEDURE dbo.usp_DynamicMerge\n    @SchemaName NVARCHAR(25),\n    @TableName NVARCHAR(50),\n    @JoinStatement NVARCHAR(4000),\n    @keyColumns NVARCHAR(4000),\n    @keyColumnsSplit = NVARCHAR(4000)\n\nAS  \nSELECT *\nFROM sys.tables\n\nDECLARE @sql NVARCHAR(4000) = 'MERGE '+ @SchemaName +'.'+ @TableName + 'AS tgt  \nUSING delta.' +@TableName + ' as src\n    ON ' + @keyColumns + ' WHEN NOT MATCHED BY SOURCE \n    THEN DELETE\nWHEN MATCHED\n    THEN UPDATE SET tgt.Quantity = tgt.Quantity - src.OrderQty,\n                    tgt.ModifiedDate = GETDATE()  \nOUTPUT deleted.*, $action, inserted.* into'\nGO  \n\nEXECUTE sp_executesql   \n          N'SELECT * FROM AdventureWorksPDW2012.dbo.DimEmployee   \n          WHERE EmployeeKey = @level',  \n          N'@level TINYINT',  \n          @level = 109; \nGO\n\n\n\n",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "ModineerServerless",
						"poolName": "Built-in"
					},
					"resultLimit": 5000
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/ExcessInventory')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"folder": {
					"name": "Serverless"
				},
				"content": {
					"query": "SELECT T1.ITEM, \nT1.REVISION,\nT1.MAS_LOC, \nT1.LOCATION, \nT1.OH_QTY, \nT2.STD_COST, \ncase  when T2.COST_METHOD like '%STD%' then T1.OH_QTY*T2.STD_COST else T1.OH_QTY*T3.AVG_COST end AS INV_VALUE, \nT3.YTD_DEP_DEM_ISS_QTY, \nT3.YTD_IND_DEM_ISS_QTY, \nT3.YTD_MFG_REC_QTY, \nT3.YTD_PI_ADJ_QTY, \nT3.YTD_PUR_RECEIPTS, \nT4.COMMODITY, \nT4.HPL, \nT2.COST_METHOD, \nT3.AVG_COST,\nCAST(GETDATE() AT TIME ZONE 'Eastern Standard Time' AS DATE) RunDate\nfrom GLOVIA_PROD.ITEM T4, \nGLOVIA_PROD.ITEM_LOC T1, \nGLOVIA_PROD.ITEM_CCN T2, \nGLOVIA_PROD.ITEM_ML T3\nwhere T4.ITEM=T1.ITEM \nand T4.REVISION=T1.REVISION \nand T4.ITEM=T2.ITEM \nand T4.REVISION=T2.REVISION \nand T3.CCN=T1.CCN \nand T3.MAS_LOC=T1.MAS_LOC \nand T3.ITEM=T1.ITEM \nand T3.REVISION=T1.REVISION \nand T4.COMMODITY<>'C'",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "master",
						"poolName": "Built-in"
					},
					"resultLimit": 5000
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/InforArAging')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"folder": {
					"name": "Infor Development"
				},
				"content": {
					"query": "-- This is auto-generated code\nSELECT 'Pulverman' AS \"Location\",\nRECEIVABLE.CUSTOMER_ID, \nCUSTOMER.NAME, \nRECEIVABLE.INVOICE_ID, \nRECEIVABLE.TYPE, \nFORMAT(CAST(RECEIVABLE.INVOICE_DATE AS DATE),'MM/dd/yyyy') INVOICE_DATE, \nRECEIVABLE.TOTAL_AMOUNT, \nRECEIVABLE.PAID_AMOUNT,\nRECEIVABLE.TOTAL_AMOUNT - RECEIVABLE.PAID_AMOUNT AS BALANCE, \nRECEIVABLE.TERMS_NET_TYPE, \nRECEIVABLE.TERMS_NET_DAYS, \nRECEIVABLE.TERMS_NET_DATE, \nRECEIVABLE.TERMS_DESCRIPTION,\nRECEIVABLE.STATUS, \nRECEIVABLE.ZERO_DATE,\nFORMAT(CAST(DATEADD(DAY,RECEIVABLE.TERMS_NET_DAYS,RECEIVABLE.INVOICE_DATE) AS DATE),'MM/dd/yyyy') AS DueDate,\nIIF(DATEDIFF(DAY,CONVERT(DATETIME, CAST(DATEADD(DAY,RECEIVABLE.TERMS_NET_DAYS,RECEIVABLE.INVOICE_DATE) AS DATE)),CONVERT(DATETIME, GETUTCDATE() AT TIME ZONE 'UTC' AT TIME ZONE 'Eastern Standard Time')) IS NOT NULL,DATEDIFF(DAY,CONVERT(DATETIME, CAST(DATEADD(DAY,RECEIVABLE.TERMS_NET_DAYS,RECEIVABLE.INVOICE_DATE) AS DATE)),CONVERT(DATETIME, GETUTCDATE() AT TIME ZONE 'UTC' AT TIME ZONE 'Eastern Standard Time')),0) AS \"Age\"\nFROM\n    OPENROWSET(\n        BULK 'https://modineerlake.dfs.core.windows.net/unified-data-cluster/Infor/TestData/RECEIVABLE.parquet',\n        FORMAT = 'PARQUET'\n    ) AS [RECEIVABLE]\n    INNER JOIN (\n        SELECT *\nFROM\n    OPENROWSET(\n        BULK 'https://modineerlake.dfs.core.windows.net/unified-data-cluster/Infor/TestData/CUSTOMER.parquet',\n        FORMAT = 'PARQUET'\n    ) AS [CUSTOMER]\n) AS [CUSTOMER]\nON [RECEIVABLE].CUSTOMER_ID = [CUSTOMER].ID\nWHERE [RECEIVABLE].ZERO_DATE IS NULL\nAND (RECEIVABLE.TOTAL_AMOUNT - RECEIVABLE.PAID_AMOUNT) <> 0\nAND [RECEIVABLE].STATUS <> 'X'\n--AND [RECEIVABLE].TYPE LIKE 'U'\nORDER BY [RECEIVABLE].INVOICE_DATE\n",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "master",
						"poolName": "Built-in"
					},
					"resultLimit": -1
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/List Stored Procedures')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"folder": {
					"name": "General"
				},
				"content": {
					"query": "SELECT \n  ROUTINE_SCHEMA,\n  ROUTINE_NAME\nFROM INFORMATION_SCHEMA.ROUTINES\nWHERE ROUTINE_TYPE = 'PROCEDURE';",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "Glovia",
						"poolName": "Built-in"
					},
					"resultLimit": 5000
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Partition Testing')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"folder": {
					"name": "Infor Development"
				},
				"content": {
					"query": "SELECT TOP 1000 *\nFROM\n    OPENROWSET(\n        BULK 'https://modineerlake.dfs.core.windows.net/unified-data-cluster/Infor/TestData/RECEIVABLE.parquet',\n        FORMAT = 'PARQUET'\n    ) AS [CR]",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "master",
						"poolName": "Built-in"
					},
					"resultLimit": 5000
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Remove Duplicates')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"folder": {
					"name": "Maintenance"
				},
				"content": {
					"query": "--TODO: Make this dynamic if it works, then add this as a process to clean data after tables refresh.\n\nDELETE T\nFROM(\n    SELECT *,\n    DupRank = ROW_NUMBER() OVER(\n        PARTITION BY CONCAT(CCN,MAS_LOC,WO_NUM,WO_LINE)\n        ORDER BY (SELECT NULL)\n    )\n    FROM GLOVIA_PROD.WO\n) AS T\nWHERE DupRank > 1",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "Modineer",
						"poolName": "Modineer"
					},
					"resultLimit": 5000
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/SQL script 1')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"content": {
					"query": "-- This is auto-generated code\nSELECT\n    TOP 100 *\nFROM\n    OPENROWSET(\n        BULK 'https://modineerlake.dfs.core.windows.net/unified-data-cluster/Infor/PART/PART-Initial.parquet',\n        FORMAT = 'PARQUET'\n    ) AS [result]\n    ORDER BY [result].ROWID DESC\n",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "master",
						"poolName": "Built-in"
					},
					"resultLimit": 5000
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Tables_Cols')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "Shows all of the columns in each table for Infor.",
				"folder": {
					"name": "Infor Development"
				},
				"content": {
					"query": "SELECT tabl.name AS table_name,\ncols.name AS column_name\nFROM\n    OPENROWSET(\n        BULK 'https://modineerlake.dfs.core.windows.net/unified-data-cluster/Infor/TestData/TableList.csv',\n        FORMAT = 'CSV',\n        PARSER_VERSION = '2.0'\n    ) AS [Tabl]\nINNER JOIN (\nSELECT *\nFROM\n    OPENROWSET(\n        BULK 'https://modineerlake.dfs.core.windows.net/unified-data-cluster/Infor/TestData/ColumnList.csv',\n        FORMAT = 'CSV',\n        PARSER_VERSION = '2.0'\n    ) AS [Columns]\n) Cols\nON [Tabl].object_id = Cols.object_id",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "master",
						"poolName": "Built-in"
					},
					"resultLimit": -1
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/DeltaMerge')]",
			"type": "Microsoft.Synapse/workspaces/notebooks",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"nbformat": 4,
				"nbformat_minor": 2,
				"bigDataPool": {
					"referenceName": "ModSparkPool",
					"type": "BigDataPoolReference"
				},
				"sessionProperties": {
					"driverMemory": "28g",
					"driverCores": 4,
					"executorMemory": "28g",
					"executorCores": 4,
					"numExecutors": 1,
					"conf": {
						"spark.dynamicAllocation.enabled": "true",
						"spark.dynamicAllocation.minExecutors": "1",
						"spark.dynamicAllocation.maxExecutors": "5",
						"spark.autotune.trackingId": "75a8e2f8-5711-4cb8-a6a3-4e2391f12e3e"
					}
				},
				"metadata": {
					"saveOutput": true,
					"enableDebugMode": false,
					"kernelspec": {
						"name": "synapse_pyspark",
						"display_name": "Synapse PySpark"
					},
					"language_info": {
						"name": "python"
					},
					"a365ComputeOptions": {
						"id": "/subscriptions/94182533-145d-4aab-ac52-b1f4c605b8b0/resourceGroups/Modineer/providers/Microsoft.Synapse/workspaces/modineerworkspace/bigDataPools/ModSparkPool",
						"name": "ModSparkPool",
						"type": "Spark",
						"endpoint": "https://modineerworkspace.dev.azuresynapse.net/livyApi/versions/2019-11-01-preview/sparkPools/ModSparkPool",
						"auth": {
							"type": "AAD",
							"authResource": "https://dev.azuresynapse.net"
						},
						"sparkVersion": "3.1",
						"nodeCount": 10,
						"cores": 4,
						"memory": 28
					},
					"sessionKeepAliveTimeout": 30
				},
				"cells": [
					{
						"cell_type": "code",
						"metadata": {
							"tags": [
								"parameters"
							]
						},
						"source": [
							"Schema = 'GLOVIA_PROD'\r\n",
							"Table = 'JE_DET'\r\n",
							"FilePath = 'unified-data-cluster'\r\n",
							"keyColumns = 'JE_CCN,JE,JE_DET,JE_LINE'\r\n",
							"updateString=''\r\n",
							"insertString=''"
						],
						"outputs": [],
						"execution_count": 2
					},
					{
						"cell_type": "code",
						"metadata": {
							"jupyter": {
								"source_hidden": false,
								"outputs_hidden": false
							},
							"nteract": {
								"transient": {
									"deleting": false
								}
							}
						},
						"source": [
							"splitCols = keyColumns.split(',')\r\n",
							"matchedString = ''\r\n",
							"for string in splitCols:\r\n",
							"    matchString += 'src.' + string + ' = tgt.' + string + ', '\r\n",
							"matchedString = matchString.rstrip(', ')"
						],
						"outputs": [],
						"execution_count": 10
					},
					{
						"cell_type": "code",
						"metadata": {
							"jupyter": {
								"source_hidden": false,
								"outputs_hidden": false
							},
							"nteract": {
								"transient": {
									"deleting": false
								}
							}
						},
						"source": [
							"dfDataOrigionalPath = f\"abfss://{FilePath}@modineerlake.dfs.core.windows.net/{Schema}/{Table}/Processed/\"\r\n",
							"dfDataChangedPath = f\"abfss://{FilePath}@modineerlake.dfs.core.windows.net/{Schema}/{Table}/NotProcessed/\"\r\n",
							"dfDataOriginal = spark.read.load(dfDataOrigionalPath, format='delta')\r\n",
							"df.write.mode(\"overwrite\").saveAsTable(f\"delta.{Table}\")\r\n",
							"tgt = spark.table(f'delta.{Table}')\r\n",
							"src = spark.read.format(\"parquet\").load(dfDataChangedPath)\r\n",
							"src.registerTempTable(\"changed\")\r\n",
							"import delta\r\n",
							""
						],
						"outputs": [],
						"execution_count": 13
					},
					{
						"cell_type": "code",
						"metadata": {
							"jupyter": {
								"source_hidden": false,
								"outputs_hidden": false
							},
							"nteract": {
								"transient": {
									"deleting": false
								}
							},
							"collapsed": false
						},
						"source": [
							"display(spark.sql(\"DESCRIBE HISTORY '\" + dfDataOrigionalPath +\"'\"))"
						],
						"outputs": [],
						"execution_count": 20
					},
					{
						"cell_type": "code",
						"metadata": {
							"jupyter": {
								"source_hidden": false,
								"outputs_hidden": false
							},
							"nteract": {
								"transient": {
									"deleting": false
								}
							}
						},
						"source": [
							"orDT = delta.DeltaTable.forPath(spark, dfDataOrigionalPath)\r\n",
							"(\r\n",
							"    orDT\r\n",
							"        .alias(\"original\")\r\n",
							"        .merge(src.alias(\"changed\"),\r\n",
							"            matchedString)\r\n",
							"        .whenMatchedUpdate(set ={updateString})\r\n",
							"        .whenNotMatchedInsert(values ={insertString})\r\n",
							"        .execute()\r\n",
							")"
						],
						"outputs": [],
						"execution_count": null
					}
				]
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Notebook 2')]",
			"type": "Microsoft.Synapse/workspaces/notebooks",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"nbformat": 4,
				"nbformat_minor": 2,
				"bigDataPool": {
					"referenceName": "ModSparkPool",
					"type": "BigDataPoolReference"
				},
				"sessionProperties": {
					"driverMemory": "28g",
					"driverCores": 4,
					"executorMemory": "28g",
					"executorCores": 4,
					"numExecutors": 1,
					"conf": {
						"spark.dynamicAllocation.enabled": "true",
						"spark.dynamicAllocation.minExecutors": "1",
						"spark.dynamicAllocation.maxExecutors": "4",
						"spark.autotune.trackingId": "cc1015e8-79e9-4b62-b99d-de377f935128"
					}
				},
				"metadata": {
					"saveOutput": true,
					"enableDebugMode": false,
					"kernelspec": {
						"name": "synapse_pyspark",
						"display_name": "python"
					},
					"language_info": {
						"name": "python"
					},
					"a365ComputeOptions": {
						"id": "/subscriptions/94182533-145d-4aab-ac52-b1f4c605b8b0/resourceGroups/Modineer/providers/Microsoft.Synapse/workspaces/modineerworkspace/bigDataPools/ModSparkPool",
						"name": "ModSparkPool",
						"type": "Spark",
						"endpoint": "https://modineerworkspace.dev.azuresynapse.net/livyApi/versions/2019-11-01-preview/sparkPools/ModSparkPool",
						"auth": {
							"type": "AAD",
							"authResource": "https://dev.azuresynapse.net"
						},
						"sparkVersion": "3.1",
						"nodeCount": 10,
						"cores": 4,
						"memory": 28
					},
					"sessionKeepAliveTimeout": 30
				},
				"cells": [
					{
						"cell_type": "code",
						"metadata": {
							"jupyter": {
								"source_hidden": false,
								"outputs_hidden": false
							},
							"nteract": {
								"transient": {
									"deleting": false
								}
							},
							"tags": [
								"parameters"
							]
						},
						"source": [
							"sch = \"\"\r\n",
							"tbl = \"\""
						],
						"outputs": [],
						"execution_count": null
					},
					{
						"cell_type": "code",
						"metadata": {
							"jupyter": {
								"source_hidden": false,
								"outputs_hidden": false
							},
							"nteract": {
								"transient": {
									"deleting": false
								}
							}
						},
						"source": [
							"#Set location of the data\r\n",
							"loc = f\"/unified-data-cluster/{sch}/{tbl}\"\r\n",
							"df = (spark\r\n",
							"        .read\r\n",
							"        .parquet(loc))"
						],
						"outputs": [],
						"execution_count": null
					}
				]
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/ModSparkPool')]",
			"type": "Microsoft.Synapse/workspaces/bigDataPools",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"autoPause": {
					"enabled": true,
					"delayInMinutes": 15
				},
				"autoScale": {
					"enabled": true,
					"maxNodeCount": 50,
					"minNodeCount": 3
				},
				"nodeCount": 10,
				"nodeSize": "Small",
				"nodeSizeFamily": "MemoryOptimized",
				"sparkVersion": "3.1",
				"isComputeIsolationEnabled": false,
				"sessionLevelPackagesEnabled": false,
				"annotations": []
			},
			"dependsOn": [],
			"location": "eastus"
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Modineer')]",
			"type": "Microsoft.Synapse/workspaces/sqlPools",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"collation": "SQL_Latin1_General_CP1_CI_AS",
				"maxSizeBytes": 263882790666240,
				"annotations": []
			},
			"dependsOn": [],
			"location": "eastus"
		},
		{
			"name": "[concat(parameters('workspaceName'), '/NetsuiteData')]",
			"type": "Microsoft.Synapse/workspaces/sqlPools",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"collation": "SQL_Latin1_General_CP1_CI_AS",
				"maxSizeBytes": 263882790666240,
				"annotations": []
			},
			"dependsOn": [],
			"location": "eastus"
		}
	]
}