{
	"name": "SQL script 3",
	"properties": {
		"content": {
			"query": "-- Create a new stored procedure called 'AddTableToRefresh' in schema 'Config'\n-- Drop the stored procedure if it already exists\nIF EXISTS (\nSELECT *\n    FROM INFORMATION_SCHEMA.ROUTINES\nWHERE SPECIFIC_SCHEMA = N'Config'\n    AND SPECIFIC_NAME = N'AddTableToRefresh'\n    AND ROUTINE_TYPE = N'PROCEDURE'\n)\nDROP PROCEDURE Config.AddTableToRefresh\nGO\n-- Create the stored procedure in the specified schema\nCREATE PROCEDURE Config.AddTableToRefresh\n    @RowGroup NVARCHAR(50),\n    @DbName NVARCHAR(50),\n    @SchemaName NVARCHAR(50),\n    @TableName NVARCHAR(50),\n    @FileSystem NVARCHAR(50),\n    @TableKeysArray NVARCHAR(500),\n    @ConnectionType NVARCHAR(50),\n    @DataQuery NVARCHAR(4000),\n    @CurrentProcess BIT,\n    @TableMaxSCN NVARCHAR(20),\n    @RefreshInterval NVARCHAR(15),\n    @RefreshNumber INT,\n    @Columns NVARCHAR(2000)\n-- add more stored procedure parameters here\nAS\nBEGIN\n    -- body of the stored procedure\n    INSERT INTO Config.DataRefreshSchedule (RowGroup, DbName, SchemaName, TableName, FileSystem, TableKeysArray, ConnectionType, DataQuery)\n    VALUES(@RowGroup, @DbName, @SchemaName, @TableName, @FileSystem, @TableKeysArray, @ConnectionType, @DataQuery)\n\n    DECLARE @ScheduleId INT = (SELECT TOP 1  Id \n                                FROM Config.DataRefreshSchedule \n                                WHERE RowGroup = @RowGroup\n                                AND DbName = @DbName\n                                AND SchemaName = @SchemaName\n                                AND TableName = @TableName\n                                AND FileSystem = @FileSystem)\n    INSERT INTO Config.DataRefreshScheduleDetail (ScheduleId, CurrentProcess, TableMaxSCN, RefreshInterval, RefreshNumber)\n    VALUES(@ScheduleId, @CurrentProcess, @TableMaxSCN, @RefreshInterval, @RefreshNumber)\n\n    DECLARE @SchemaId INT = (SELECT schema_id FROM sys.schemas WHERE name = @SchemaName)\n\n    DECLARE @sql NVARCHAR(4000) = 'IF ((SELECT COUNT(*) FROM sys.tables WHERE name = @TableName AND schema_id = @SchemaId) > 0)\n    DROP TABLE [@SchemaName].[@TableName]\n\n    CREATE TABLE [@SchemaName].[@TableName]' + @Columns\n    SET @sql = REPLACE(@sql,'@SchemaName',@SchemaName)\n    SET @sql = REPLACE(@sql, '@TableName', @TableName)\n\n    EXEC sp_executesql @sql\nEND\nGO",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "Modineer",
				"poolName": "Modineer"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}